var mod=angular.module("app.productApp",[]),mod=angular.module("app.saleApp",[]),mod=angular.module("model.group",[]),mod=angular.module("model.mix_match",[]),mod=angular.module("model.non_inventory",[]);angular.module("model.product",[]);var mod=angular.module("model.receipt",[]),mod=angular.module("model.report",[]),mod=angular.module("model.store",[]);angular.module("model.store_product",[]);var mod=angular.module("share.menu",[]),mod=angular.module("share.ui",[]),mod=angular.module("share.util",[]);!function(e){function t(t){try{e.module(t)}catch(r){return!1}return!0}function r(e,r,o){function n(){e.$on("$locationChangeStart",function(e){r.$_blockLocationChange&&r.state().blockCount>0&&e.preventDefault()}),e.$on("$locationChangeSuccess",function(){r.$_blockLocationChange=o.blockBrowserNavigation})}if(o.blockBrowserNavigation)if(t("ngRoute"))var s=e.$on("$viewContentLoaded",function(){s(),n()});else n()}var o=e.module("blockUI",[]);o.config(["$provide","$httpProvider",function(e,t){e.decorator("$exceptionHandler",["$delegate","$injector",function(e,t){var r,o;return function(n,s){if(o=o||t.get("blockUIConfig"),o.resetOnException)try{r=r||t.get("blockUI"),r.instances.reset()}catch(i){console.log("$exceptionHandler",n)}e(n,s)}}]),t.interceptors.push("blockUIHttpInterceptor")}]),o.run(["$document","blockUIConfig","$templateCache",function(e,t,r){t.autoInjectBodyBlock&&e.find("body").attr("block-ui","main"),t.template&&(t.templateUrl="$$block-ui-template$$",r.put(t.templateUrl,t.template))}]),o.config(["$provide",function(e){e.decorator("$location",n)}]);var n=["$delegate","blockUI","blockUIConfig",function(t,r,o){function n(e){var o=t[e];t[e]=function(){var e=o.apply(t,arguments);return e===t&&(r.$_blockLocationChange=!1),e}}if(o.blockBrowserNavigation){r.$_blockLocationChange=!0;var s=["url","path","search","hash","state"];e.forEach(s,n)}return t}];o.directive("blockUiContainer",["blockUIConfig","blockUiContainerLinkFn",function(e,t){return{scope:!0,restrict:"A",templateUrl:e.templateUrl,compile:function(e){return t}}}]).factory("blockUiContainerLinkFn",["blockUI","blockUIUtils",function(e,t){return function(e,t,r){var o=t.inheritedData("block-ui");if(!o)throw new Error("No parent block-ui service instance located.");e.state=o.state()}}]),o.directive("blockUi",["blockUiCompileFn",function(e){return{scope:!0,restrict:"A",compile:e}}]).factory("blockUiCompileFn",["blockUiPreLinkFn",function(e){return function(t,r){return t.append('<div block-ui-container class="block-ui-container"></div>'),{pre:e}}}]).factory("blockUiPreLinkFn",["blockUI","blockUIUtils","blockUIConfig",function(e,t,o){return function(n,s,i){s.hasClass("block-ui")||s.addClass(o.cssClass),i.$observe("blockUiMessageClass",function(e){n.$_blockUiMessageClass=e});var u=i.blockUi||"_"+n.$id,l=e.instances.get(u);if("main"===u)r(n,l,o);else{var a=s.inheritedData("block-ui");a&&(l._parent=a)}n.$on("$destroy",function(){l.release()}),l.addRef(),n.$_blockUiState=l.state(),n.$watch("$_blockUiState.blocking",function(e){s.attr("aria-busy",!!e),s.toggleClass("block-ui-visible",!!e)}),n.$watch("$_blockUiState.blockCount > 0",function(e){s.toggleClass("block-ui-active",!!e)});var c=i.blockUiPattern;if(c){var _=t.buildRegExp(c);l.pattern(_)}s.data("block-ui",l)}}]),o.constant("blockUIConfig",{templateUrl:"angular-block-ui/angular-block-ui.ng.html",delay:250,message:"Loading ...",autoBlock:!0,resetOnException:!0,requestFilter:e.noop,autoInjectBodyBlock:!0,cssClass:"block-ui block-ui-anim-fade",blockBrowserNavigation:!1}),o.factory("blockUIHttpInterceptor",["$q","$injector","blockUIConfig","$templateCache",function(e,t,r,o){function n(){u=u||t.get("blockUI")}function s(e){r.autoBlock&&e&&!e.$_noBlock&&e.$_blocks&&(n(),e.$_blocks.stop())}function i(t){try{s(t.config)}catch(r){console.log("httpRequestError",r)}return e.reject(t)}var u;return{request:function(e){if(r.autoBlock&&("GET"!=e.method||!o.get(e.url))){var t=r.requestFilter(e);t===!1?e.$_noBlock=!0:(n(),e.$_blocks=u.instances.locate(e),e.$_blocks.start(t))}return e},requestError:i,response:function(e){return e&&s(e.config),e},responseError:i}}]),o.factory("blockUI",["blockUIConfig","$timeout","blockUIUtils","$document",function(t,r,o,n){function s(s){var l,c=this,_={id:s,blockCount:0,message:t.message,blocking:!1},d=[];this._id=s,this._refs=0,this.start=function(s){function a(){l=null,_.blocking=!0}s=s||{},e.isString(s)?s={message:s}:e.forEach(u,function(e){if(s[e])throw new Error("The property "+e+" is reserved for the block state.")}),e.extend(_,s),_.blockCount>0?_.message=s.message||_.message||t.message:_.message=s.message||t.message,_.blockCount++;var d=e.element(n[0].activeElement);d.length&&o.isElementInBlockScope(d,c)&&(c._restoreFocus=d[0],r(function(){c._restoreFocus&&c._restoreFocus!==i[0]&&c._restoreFocus.blur()})),l||0===t.delay?0===t.delay&&a():l=r(a,t.delay)},this._cancelStartTimeout=function(){l&&(r.cancel(l),l=null)},this.stop=function(){_.blockCount=Math.max(0,--_.blockCount),0===_.blockCount&&c.reset(!0)},this.isBlocking=function(){return _.blocking},this.message=function(e){_.message=e},this.pattern=function(e){return void 0!==e&&(c._pattern=e),c._pattern},this.reset=function(t){if(c._cancelStartTimeout(),_.blockCount=0,_.blocking=!1,c._restoreFocus&&(!n[0].activeElement||n[0].activeElement===i[0])){try{c._restoreFocus.focus()}catch(o){!function(){var e=c._restoreFocus;r(function(){if(e)try{e.focus()}catch(t){}},100)}()}c._restoreFocus=null}try{t&&e.forEach(d,function(e){e()})}finally{d.length=0}},this.done=function(e){d.push(e)},this.state=function(){return _},this.addRef=function(){c._refs+=1},this.release=function(){--c._refs<=0&&a.instances._destroy(c)}}var i=n.find("body"),u=["id","blockCount","blocking"],l=[];l.get=function(e){if(!isNaN(e))throw new Error("BlockUI id cannot be a number");var t=l[e];return t||(t=l[e]=new s(e),l.push(t)),t},l._destroy=function(t){if(e.isString(t)&&(t=l[t]),t){t.reset();var r=o.indexOf(l,t);l.splice(r,1),delete l[t.state().id]}},l.locate=function(e){var t=[];o.forEachFnHook(t,"start"),o.forEachFnHook(t,"stop");for(var r=l.length;r--;){var n=l[r],s=n._pattern;s&&s.test(e.url)&&t.push(n)}return 0===t.length&&t.push(a),t},o.forEachFnHook(l,"reset");var a=l.get("main");return a.addRef(),a.instances=l,a}]),o.factory("blockUIUtils",function(){var t=e.element,r={buildRegExp:function(e){var t,r=e.match(/^\/(.*)\/([gim]*)$/);if(!r)throw Error("Incorrect regular expression format: "+e);return t=new RegExp(r[1],r[2])},forEachFn:function(e,t,r){for(var o=e.length;o--;){var n=e[o];n[t].apply(n,r)}},forEachFnHook:function(e,t){e[t]=function(){r.forEachFn(this,t,arguments)}},isElementInBlockScope:function(e,t){for(var r=e.inheritedData("block-ui");r;){if(r===t)return!0;r=r._parent}return!1},findElement:function(e,o,n){var s=null;if(o(e))s=e;else{var i;i=n?e.parent():e.children();for(var u=i.length;!s&&u--;)s=r.findElement(t(i[u]),o,n)}return s},indexOf:function(e,t,r){for(var o=r||0,n=e.length;o<n;o++)if(e[o]===t)return o;return-1}};return r}),e.module("blockUI").run(["$templateCache",function(e){e.put("angular-block-ui/angular-block-ui.ng.html",'<div class="block-ui-overlay"></div><div class="block-ui-message-container" aria-live="assertive" aria-atomic="true"><div class="block-ui-message" ng-class="$_blockUiMessageClass">{{ state.message }}</div></div>')}])}(angular);var mod;mod=angular.module("infinite-scroll",[]),mod.value("THROTTLE_MILLISECONDS",null),mod.directive("infiniteScroll",["$rootScope","$window","$interval","THROTTLE_MILLISECONDS",function(e,t,r,o){return{scope:{infiniteScroll:"&",infiniteScrollContainer:"=",infiniteScrollDistance:"=",infiniteScrollDisabled:"=",infiniteScrollUseDocumentBottom:"=",infiniteScrollListenForEvent:"@"},link:function(n,s,i){var u,l,a,c,_,d,p,m,g,f,h,v,b,k,y,x,w,$,T;return T=angular.element(t),k=null,y=null,a=null,c=null,h=!0,$=!1,w=null,l=!1,f=function(e){return e=e[0]||e,isNaN(e.offsetHeight)?e.document.documentElement.clientHeight:e.offsetHeight},v=function(e){if(e[0].getBoundingClientRect&&!e.css("none"))return e[0].getBoundingClientRect().top+b(e)},b=function(e){return e=e[0]||e,isNaN(window.pageYOffset)?e.document.documentElement.scrollTop:e.ownerDocument.defaultView.pageYOffset},g=function(){var t,o,i,u,_;return c===T?(t=f(c)+b(c[0].document.documentElement),i=v(s)+f(s)):(t=f(c),o=0,void 0!==v(c)&&(o=v(c)),i=v(s)-o+f(s)),$&&(i=f((s[0].ownerDocument||s[0].document).documentElement)),u=i-t,_=u<=f(c)*k+1,_?(a=!0,y?n.$$phase||e.$$phase?n.infiniteScroll():n.$apply(n.infiniteScroll):void 0):(l&&r.cancel(l),a=!1)},x=function(e,t){var o,n,s;return s=null,n=0,o=function(){var t;return n=(new Date).getTime(),r.cancel(s),s=null,e.call(),t=null},function(){var i,u;return i=(new Date).getTime(),u=t-(i-n),u<=0?(clearTimeout(s),r.cancel(s),s=null,n=i,e.call()):s?void 0:s=r(o,u,1)}},null!=o&&(g=x(g,o)),n.$on("$destroy",function(){if(c.unbind("scroll",g),null!=w)return w(),w=null}),p=function(e){return k=parseFloat(e)||0},n.$watch("infiniteScrollDistance",p),p(n.infiniteScrollDistance),d=function(e){if(y=!e,y&&a)return a=!1,g()},n.$watch("infiniteScrollDisabled",d),d(n.infiniteScrollDisabled),m=function(e){return $=e},n.$watch("infiniteScrollUseDocumentBottom",m),m(n.infiniteScrollUseDocumentBottom),u=function(e){if(null!=c&&c.unbind("scroll",g),c=e,null!=e)return c.bind("scroll",g)},u(T),n.infiniteScrollListenForEvent&&(w=e.$on(n.infiniteScrollListenForEvent,g)),_=function(e){if(null!=e&&0!==e.length){if(e instanceof HTMLElement?e=angular.element(e):"function"==typeof e.append?e=angular.element(e[e.length-1]):"string"==typeof e&&(e=angular.element(document.querySelector(e))),null!=e)return u(e);throw new Exception("invalid infinite-scroll-container attribute.")}},n.$watch("infiniteScrollContainer",_),_(n.infiniteScrollContainer||[]),null!=i.infiniteScrollParent&&u(angular.element(s.parent())),null!=i.infiniteScrollImmediateCheck&&(h=n.$eval(i.infiniteScrollImmediateCheck)),l=r(function(){if(h)return g()},0)}}}]);var mod=angular.module("share.offline_db_util",[]);mod.factory("share.offline_db_util",["$q","$rootScope","share_setting","blockUI",function(e,t,r,o){function n(){var e=r.STORE_DB_PREFIX+r.STORE_ID;return new PouchDB(e)}function s(t){var r=e.defer(),o=n();return o.get(t).then(function(e){o.remove(e).then(function(e){r.resolve(e)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise}function i(){var t=e.defer(),o="_pouch_"+r.STORE_DB_PREFIX+r.STORE_ID,n=indexedDB.open(o);return n.onupgradeneeded=function(e){e.target.transaction.abort()},n.onsuccess=function(e){t.resolve(!0)},n.onerror=function(e){"AbortError"==e.target.error.name?(indexedDB.deleteDatabase(o),t.resolve(!1)):t.reject("error when checking db existance")},t.promise}function u(t){var r=e.defer();return t?l().then(function(e){r.resolve(e)},function(e){r.reject(e)}):i().then(function(e){e?l().then(function(e){r.resolve(e)},function(e){r.reject(e)}):r.resolve(null)},function(e){return r.reject(e)}),r.promise}function l(){var r=e.defer(),n=18,s="liquor_"+n,i=new PouchDB(s),u="https://ffireventaiduretrimarril:O7bnrIIMumwfueNuMat6SnaA@khanhlu2013ceci.cloudant.com",l=u+"/"+s;return o.start("syncing database ..."),console.log("begin syncing for store_id: "+n),PouchDB.replicate(l,i,{batch_size:200,batches_limit:10}).on("change",function(e){t.$apply(function(){var t=e.docs_written+" products synced";o.message(t)})}).on("complete",function(e){r.resolve(e),o.stop()}).on("error",function(e){t.$apply(function(){var t="there is sync error: "+e;r.reject(t),o.stop()})}),r.promise}function a(e){return e+"/"+e}return{get:n,remove_doc:s,is_exist:i,download_product:u,get_pouch_view_name:a}}]);var mod=angular.module("share.validation.number",[]);mod.directive("validFloat",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,o){var n=function(e,t){if(e=e.trim(),isNaN(e))return!1;var e=Number(e),t=r.validFloat;return""===t||("gt0"===t?e>0:"gte0"===t&&e>=0)};o.$parsers.unshift(function(e){if(null===e||0===e.trim().length)return o.$setValidity("validFloat",!0),null;var t=n(e);return o.$setValidity("validFloat",t),t?Number(e):void 0}),o.$formatters.unshift(function(e){return null===e||0===e.trim().length?o.$setValidity("validFloat",!0):o.$setValidity("validFloat",n(e)),e})}}});var mod=angular.module("share.directive",[]);mod.directive("ngEnter",function(){return function(e,t,r){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(r.ngEnter)}),t.preventDefault())})}}),mod.directive("blurMe",["$timeout","$parse",function(e,t){return{link:function(r,o,n){var s=t(n.blurMe);r.$watch(s,function(t){t===!0&&e(function(){o[0].blur()})}),o.bind("focus",function(){void 0!==s.assign&&s.assign(r,!1)})}}}]),mod.directive("focusMe",["$timeout","$parse",function(e,t){return{link:function(r,o,n){var s=t(n.focusMe);r.$watch(s,function(t){t===!0&&e(function(){o[0].focus()})}),o.bind("blur",function(){void 0!==s.assign&&r.$apply(s.assign(r,!1))})}}}]);var mod=angular.module("share.filter",[]);mod.filter("not_show_zero",function(){return function(e){return"$0.00"===e?"":"0"===e?"":0===e?"":e}}),mod.filter("emptyToEnd",function(){return function(e,t){if(angular.isArray(e)){var r=e.filter(function(e){return t.indexOf("()")!=-1?e[t.replace("()","")]():e[t]}),o=e.filter(function(e){return t.indexOf("()")!=-1?!e[t.replace("()","")]():!e[t]});return r.concat(o)}}});var mod=angular.module("share.menu");mod.requires.push.apply(mod.requires,["share.ui","model.group"]),mod.controller("share.menu.menuCtrl",["$scope","$window","share.ui.alert","share.ui.confirm","model.group.manage",function(e,t,r,o,n){e.menu_setting_group=function(){n()},e.menu_setting_store=function(){r("store settings")},e.menu_setting_mix_match=function(){r("mix match settings")},e.menu_setting_payment_type=function(){r("payment type settings")},e.menu_setting_shortcut=function(){r("shortcut")},e.menu_action_logout=function(){o("logout?").then(function(){t.location.href="/account/logout/"})}}]);var mod=angular.module("share.ui");mod.factory("share.ui.alert",["$modal",function(e){return function(t,r,o){void 0===r&&(r="alert"),void 0===o&&(o="red");var n;if("string"==typeof t){if(n=t,"_cancel_"===n||void 0===n||"backdrop click"===n||"escape key press"===n)return}else"PouchError"===t.constructor.name||"Error"===t.constructor.name?(r="Pouch error: "+t.name,n=t.message):0===t.status?n="internet is disconnected!":(r="please report ajax bug:",n="url: "+t.config.url);var s="";"green"==o?s="alert alert-success":"blue"==o?s="alert alert-info":"orange"==o?s="alert alert-warning":"red"==o&&(s="alert alert-danger");var i='<form name="form" novalidate><div id="service/ui/alert/dialog" class="modal-header '+s+'"><h3 class="modal-title">'+r+'</h3></div><div class="modal-body"><h1 id="service/ui/alert/message_lbl">'+n+'</h1></div><div class="modal-footer"><button id="service/ui/alert/ok_btn" type="submit" class="btn btn-success" ng-click="ok()">ok</button></div></form>',u=function(e,t){e.ok=function(){t.close()}};u.$inject=["$scope","$modalInstance"];e.open({template:i,controller:u,size:"md"})}}]);var mod=angular.module("share.ui");mod.factory("share.ui.confirm",["$modal",function(e){return function(t,r){null==r&&(r="warning");var o="alert alert-"+r,n='<div id="service/ui/confirm/dialog" class="modal-header '+o+'"><h3 class="modal-title">confirm</h3></div><div class="modal-body"><h1 id="service/ui/confirm/message_txt">'+t+'</h1></div><div class="modal-footer"><button id="service/ui/confirm/cancel_btn" class="btn btn-warning" ng-click="cancel()" type="button">cancel</button><button id="service/ui/confirm/ok_btn" type="submit" class="btn btn-success" ng-click="ok()">ok</button></div>',s=function(e,t){e.ok=function(){t.close()},e.cancel=function(){t.dismiss("_cancel_")}};s.$inject=["$scope","$modalInstance"];var i=e.open({template:n,controller:s,size:"md"});return i.result}}]),angular.module("share.util.csrf",[]).config(["$httpProvider",function(e){e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFToken",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.withCredentials=!0;var t=function(e){var r,o,n,s,i,u,l,a="";for(r in e)if(o=e[r],o instanceof Array)for(l=0;l<o.length;++l)i=o[l],n=r+"["+l+"]",u={},u[n]=i,a+=t(u)+"&";else if(o instanceof Object)for(s in o)i=o[s],n=r+"["+s+"]",u={},u[n]=i,a+=t(u)+"&";else void 0!==o&&null!==o&&(a+=encodeURIComponent(r)+"="+encodeURIComponent(o)+"&");return a.length?a.substr(0,a.length-1):a};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]}]);var mod=angular.module("share.util");mod.factory("share.util.misc",function(){function e(e){return e.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])}function t(e,t){for(var r=null,o=0;o<t.length;o++)if(t[o].id==e){r=t[o];break}return r}return{get_unique_lst:e,get_item_from_lst_base_on_id:t}});var mod=angular.module("share.util");mod.factory("share.util.number",function(){function e(e){return parseFloat(e.toFixed(2))}function t(e){return parseFloat(e.toFixed(1))}return{round_float_1_decimal:t,round_float_2_decimal:e}});var mod=angular.module("model.group");mod.requires.push.apply(mod.requires,["model.store_product"]),mod.factory("model.group.Group",["$injector",function(e){function t(e,t,r){this.id=e,this.name=t,this.sp_lst=r}return t.build=function(r){var o=null,n=e.get("model.store_product.Store_product");return void 0!=r.sp_lst&&(o=r.sp_lst.map(n.build)),new t(r.id,r.name,o)},t}]);var mod=angular.module("model.group");mod.factory("model.group.create",["$q","model.group.prompt","model.group.rest",function(e,t,r){return function(){var o=e.defer();return t(null).then(function(e){r.create_item(e).then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise}}]);var mod=angular.module("model.group");mod.factory("model.group.edit",["$http","$q","model.group.prompt","model.group.rest",function(e,t,r,o){return function(e){var n=t.defer();return o.get_item(e.id).then(function(e){return r(e)},function(e){n.reject(e)}).then(function(t){o.edit_item(t,e.id).then(function(e){n.resolve(e)},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise}}]);var mod=angular.module("model.group");mod.requires.push.apply(mod.requires,["share.ui"]),mod.factory("model.group.manage",["$modal","$templateCache","model.group.rest",function(e,t,r){return function(){var o=e.open({template:t.get("model.group.manage.html"),controller:"model.group.manage.modalCtrl",size:"lg",resolve:{group_lst:function(){return r.get_lst()}}});return o.result}}]),mod.controller("model.group.manage.modalCtrl",["$scope","$modalInstance","$rootScope","share.ui.confirm","share.ui.alert","model.group.execute","model.group.edit","model.group.create","model.group.rest","group_lst",function(e,t,r,o,n,s,i,u,l,a){e.group_lst=a,e.execute_group=function(e){s(e)},e.delete_group=function(t){o("delete "+t.name+" group?").then(function(r){r!==!1&&l.delete_item(t.id).then(function(){for(var r=null,o=0;o<e.group_lst.length;o++)if(e.group_lst[o].id===t.id){r=o;break}null===r?n("Bug: should be unreachable. can not find deleted index after success response"):e.group_lst.splice(o,1)},function(e){n(e)})})},e.add_group=function(){u().then(function(t){e.group_lst.push(t)},function(e){n(e)})},e.edit_group=function(e){i(e).then(function(t){angular.copy(t,e)},function(e){n(e)})},e.exit=function(){r.$emit("model.group.manage",e.group_lst),t.close()}}]);var mod=angular.module("model.group");mod.requires.push.apply(mod.requires,["share.ui","share.util","model.store_product"]),mod.factory("model.group.prompt",["$modal","$templateCache","share.ui.alert","share.util.misc","model.store_product.search.online.multiple",function(e,t,r,o,n){return function(s){var i=function(e,t,s){null==s&&(s={sp_lst:[]}),e.original_group=s,e.group=angular.copy(e.original_group),e.remove_sp=function(t){for(var r=0;r<e.group.sp_lst.length;r++)if(t.id==e.group.sp_lst[r].id){e.group.sp_lst.splice(r,1);break}},e.add_sp=function(){n().then(function(t){for(var r=0;r<t.length;r++)null==o.get_item_from_lst_base_on_id(t[r].id,e.group.sp_lst)&&e.group.sp_lst.push(t[r])},function(e){r(e)})},e.is_unchange=function(){return angular.equals(e.group,e.original_group)},e.reset=function(){e.group=angular.copy(e.original_group)},e.ok=function(){t.close(e.group)},e.cancel=function(){t.dismiss("_cancel_")}};i.$inject=["$scope","$modalInstance","original_group"];var u=e.open({template:t.get("model.group.prompt.html"),controller:i,size:"md",backdrop:"static",resolve:{original_group:function(){return s}}});return u.result}}]);var mod=angular.module("model.group");mod.factory("model.group.rest",["$http","$q","model.group.Group",function(e,t,r){function o(o){var n=t.defer();return e({url:"/group/get_item",method:"GET",params:{group_id:o}}).then(function(e){n.resolve(r.build(e.data))},function(e){n.reject(e)}),n.promise}function n(o,n){var s=t.defer();return e({url:"/group/update_angular",method:"POST",data:{group:JSON.stringify(o),id:n}}).then(function(e){s.resolve(r.build(e.data))},function(e){s.reject(e)}),s.promise}function s(){var o=t.defer();return e({url:"/group/get_lst",method:"GET"}).then(function(e){o.resolve(e.data.map(r.build))},function(e){o.reject(e)}),o.promise}function i(o){var n=t.defer();return e({url:"/group/insert_angular",method:"POST",data:{group:JSON.stringify(o)}}).then(function(e){n.resolve(r.build(e.data))},function(e){return t.reject(e)}),n.promise}function u(r){var n=t.defer();return o(r).then(function(t){0===t.sp_lst.length?e({url:"/group/delete_angular",method:"POST",data:{group_id:r}}).then(function(){n.resolve()},function(e){n.reject(e)}):n.reject("group must be empty to be deleted")},function(e){n.reject(e)}),n.promise}function l(o,n){var s=t.defer();return e({method:"POST",url:"/group/execute",data:{group_id:o,option:JSON.stringify(n)}}).then(function(e){s.resolve(r.build(e.data))},function(e){s.reject(e)}),s.promise}return{delete_item:u,create_item:i,get_lst:s,get_item:o,edit_item:n,execute_item:l}}]);var mod=angular.module("model.mix_match");mod.requires.push.apply(mod.requires,["model.store_product"]),mod.factory("model.mix_match.Mix_match",["model.store_product.Store_product",function(e){function t(e,t,r,o,n,s,i){this.id=e,this.name=t,this.mm_price=r,this.is_include_crv_tax=o,this.qty=n,this.sp_lst=s,this.is_disable=i}return t.build=function(r){return new t(r.id,r.name,parseFloat(r.mm_price),r.is_include_crv_tax,r.qty,r.sp_lst.map(e.build),r.is_disable)},t}]);var mod=angular.module("model.product");mod.factory("model.product.Prod_sku_assoc",[function(){function e(e,t,r,o){this.product_id=e,this.creator_id=t,this.store_lst=r,this.sku_str=o}return e.build=function(t){return new e(t.product_id,t.creator_id,t.store_set,t.sku_str)},e}]);var mod=angular.module("model.product");mod.requires.push.apply(mod.requires,["share.util"]),mod.factory("model.product.Product",["$injector","model.product.Prod_sku_assoc","share.util.number","share.util.misc",function(e,t,r,o){function n(e,t,r,o){this.product_id=e,this.name=t,this.sp_lst=r,this.prod_sku_assoc_lst=o}function s(e,t){for(var r=null,o=0;o<t.length;o++)if(t[o].value===e){r=t[o];break}return r}function i(e,t){for(var r=!1,o=0;o<t.length;o++)if(e.store_id===t[o]){r=!0;break}return r}function u(e){var t=o.get_unique_lst(e);return t}function l(e){if(0==e.length)return null;e.sort(function(e,t){return t-e});var t=Math.floor(e.length/2);return e.length%2?e[t]:r.round_float_2_decimal((e[t-1]+e[t])/2)}return n.prototype={constructor:n,get_sp_lst:function(e){if(null===e||void 0===e)return this.sp_lst;var t=this.prod_sku_assoc_lst.filter(function(t){return t.sku_str===e});if(0===t.length)return[];if(1!==t.length)throw Exception("Bug: product model is corrupted.");for(var r=t[0],o=r.store_lst,n=[],s=0;s<this.sp_lst.length;s++){var u=this.sp_lst[s];i(u,o)&&n.push(u)}return n},get_suggest_main:function(e){if("price"===e||"cost"===e)return l(this._get_suggest_raw_detail(e));var t=this._get_mode_statistic(e);return 0!==t.length?t[0]:null},get_suggest_extra:function(e){return"price"===e||"cost"===e?u(this._get_suggest_raw_detail(e)):this._get_mode_statistic(e)},_get_mode_statistic:function(e){if("price"===e||"cost"===e)return null;for(var t=this._get_suggest_raw_detail(e),r=[],o=0;o<t.length;o++){var n=t[o],i=s(n,r);null===i?(i={value:n,count:1,percent:null},r.push(i)):i.count+=1}for(var u=0,o=0;o<r.length;o++)u+=r[o].count;for(var o=0;o<r.length;o++)r[o].percent=Math.round(r[o].count/u*100);return r.sort(function(e,t){return t.count-e.count})},_get_suggest_raw_detail:function(e){for(var t=[],r=this.sp_lst,o=0;o<r.length;o++)if("price"==e)null!=r[o].price&&t.push(r[o].price);else if("cost"==e)null!=r[o].get_cost()&&t.push(r[o].get_cost());else if("crv"==e)null!=r[o].get_crv()&&t.push(r[o].get_crv());else if("name"==e)t.push(r[o].name);else{if("is_taxable"!=e)return null;t.push(r[o].is_taxable)}return t}},n.build=function(r){Store_product=e.get("model.store_product.Store_product");var o=null;void 0!=r.store_product_set&&(o=r.store_product_set.map(Store_product.build));var s=null;return void 0!=r.prodskuassoc_set&&(s=r.prodskuassoc_set.map(t.build)),new n(r.product_id,r.name,o,s)},n}]);var mod=angular.module("model.receipt");mod.requires.push.apply(mod.requires,["share.offline_db_util"]),mod.factory("model.receipt.dao",["$q","model.receipt.storage_adapter","share_setting","blockUI","share.offline_db_util",function(e,t,r,o,n){function s(){o.start("getting offline receipt ...");var s=e.defer();return n.is_exist().then(function(e){if(e){var i=n.get(),u=n.get_pouch_view_name(r.VIEW_BY_D_TYPE);i.query(u,{key:r.RECEIPT_DOCUMENT_TYPE}).then(function(e){for(var r=[],n=0;n<e.rows.length;n++)r.push(e.rows[n].value);s.resolve(r.map(function(e){return t.pouch_2_javascript(e)})),o.stop()},function(e){s.reject("Bug: get offline receipt has error"),o.stop()})}else s.resolve(null),o.stop()},function(e){s.reject(e),o.stop()}),s.promise}function i(r){o.start("getting offline receipt ...");var s=e.defer();return n.is_exist().then(function(e){if(e){var i=n.get();i.get(r).then(function(e){s.resolve(t.pouch_2_javascript(e)),o.stop()},function(e){s.reject(e),o.stop()})}else s.resolve(null),o.stop()},function(e){s.reject(e),o.stop()}),s.promise}function u(r,o){var s=e.defer();r.tender_ln_lst=o;var u=n.get();return u.put(t.javascript_2_pouch(r),r.doc_id,r.doc_rev).then(function(e){i(e.id).then(function(e){s.resolve(r)},function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise}return{get_receipt_lst:s,get_item:i,adjust_receipt_tender:u}}]);var mod=angular.module("model.receipt");mod.requires.push.apply(mod.requires,["share.offline_db_util"]),mod.factory("model.receipt.push",["$http","$q","model.receipt.dao","share.offline_db_util","blockUI",function(e,t,r,o,n){function s(e,r){var n=t.defer();if(0===e.length&&0===r.length)return n.resolve(!0),n.promise;for(var s=[],i=0;i<e.length;i++)s.push(o.remove_doc(e[i]));for(var i=0;i<r.length;i++)s.push(o.remove_doc(r[i]));return t.all(s).then(function(){o.download_product(!1).then(function(){n.resolve()},function(e){n.reject(e)})},function(e){d,efer.reject(e)}),n.promise}return function(){n.start("uploading receipts ...");var o=t.defer();return r.get_receipt_lst().then(function(t){null===t?(o.resolve(null),n.stop()):0===t.length?(o.resolve({receipt_count:0,offline_product_count:0}),n.stop()):e({method:"POST",url:"/receipt/push",data:{receipt_lst:JSON.stringify(t)}}).then(function(e){var t=e.data.receipt_doc_id_lst,r=e.data.sp_doc_id_lst;s(t,r).then(function(){o.resolve({receipt_count:t.length,offline_product_count:r.length}),n.stop()},function(e){o.reject(e),n.stop()})},function(e){o.reject(e),n.stop()})},function(e){o.reject(e),n.stop()}),o.promise}}]);var mod=angular.module("model.receipt");mod.requires.push.apply(mod.requires,["share.util"]),mod.factory("model.receipt.storage_adapter",["share_setting","share.util.misc",function(e,t){function r(e){return e}function o(e){var t=null;return null!==e&&(t=new Mix_match_deal_info_stamp(e.name,e.unit_discount)),t}function n(e){var t=null;return null!==e&&(t=new Non_inventory(e.name,e.price,e.is_taxable,e.crv,e.cost)),t}function s(e){var t=null;return null!==e&&(t=new Store_product_stamp(e.sp_id,e.doc_id,e.offline_create_sku,e.name,e.price,e.value_customer_price,e.crv,e.is_taxable,e.is_sale_report,e.p_type,e.p_tag,e.cost,e.vendor,e.buydown)),t}function i(e){var t=new Receipt_ln(e.id,e.qty,e.discount,e.override_price,null,s(e.store_product_stamp),o(e.mm_deal_info_stamp),n(e.non_inventory),new Date(e.date));return t}function u(r){var o=null;null!==r.pt&&(o=t.get_item_from_lst_base_on_id(r.pt.id,e.PAYMENT_TYPE_LST));var n=new Tender_ln(r.id,o,r.amount,r.name);return n}function l(e){var t=new Receipt(e.id,new Date(e.date),e.tax_rate,e.tender_ln_lst.map(function(e){return u(e)}),e.receipt_ln_lst.map(i),e._id,e._rev);return t}function a(t){var o={id:t.id,date:t.date.toString(),tax_rate:t.tax_rate,tender_ln_lst:t.tender_ln_lst,receipt_ln_lst:t.receipt_ln_lst.map(r),d_type:e.RECEIPT_DOCUMENT_TYPE};return o}return{javascript_2_pouch:a,pouch_2_javascript:l}}]);var mod=angular.module("model.report");mod.requires.push.apply(mod.requires,["model.store_product"]),mod.factory("model.report.Report",["$injector",function(e){function t(e,t,r){this.id=e,this.name=t,this.sp_lst=r}return t.build=function(r){var o=null,n=e.get("model.store_product.Store_product");return void 0!=r.sp_lst&&(o=r.sp_lst.map(n.build)),new t(r.id,r.name,o)},t}]);var mod=angular.module("model.store");mod.factory("model.store.Store",[function(){function e(e,t,r,o,n,s,i,u,l,a,c,_,d,p,m,g,f,h){this.id=e,this.name=t,this.tax_rate=r,this.phone=o,this.street=n,this.city=s,this.state=i,this.zip_code=u,this.is_profit_information_exchange=l,this.display_is_report=a,this.display_type=c,this.display_tag=_,this.display_group=d,this.display_deal=p,this.display_vendor=m,this.display_buydown=g,this.display_vc_price=f,this.display_stock=h}return e.build=function(t){return new e(t.id,t.name,parseFloat(t.tax_rate),t.phone,t.street,t.city,t.state,t.zip_code,t.is_profit_information_exchange,t.display_is_report,t.display_type,t.display_tag,t.display_group,t.display_deal,t.display_vendor,t.display_buydown,t.display_vc_price,t.display_stock)},e}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["model.product","share.util","share.offline_db_util"]),mod.factory("model.store_product.dao",["$q","model.store_product.Store_product","model.store_product.Kit_breakdown_assoc","model.product.Product","model.product.Prod_sku_assoc","share.util.misc","share_setting","blockUI","share.offline_db_util",function(e,t,r,o,n,s,i,u,l){function a(e,i){for(var u=[],l=0;l<e.sku_lst.length;l++){var a=new n(e.product_id,null,[e.store_id],e.sku_lst[l]);u.push(a)}for(var c=new o(e.product_id,null,null,u),_=[],l=0;l<e.breakdown_assoc_lst.length;l++){var d=e.breakdown_assoc_lst[l],p=s.get_item_from_lst_base_on_property("product_id",d.product_id,i);_.push(new r(null,p,d.qty))}var m=null,p=new t(e.id,e.product_id,e.store_id,e.name,e.price,e.value_customer_price,e.crv,e.is_taxable,e.is_sale_report,e.p_type,e.p_tag,e.cost,e.vendor,e.buydown,c,null,_,m,e._id,e._rev,null,null);return p}function c(t){var r=e.defer();if(0===t.breakdown_assoc_lst.length)r.resolve(a(t,[]));else{for(var o=[],n=0;n<t.breakdown_assoc_lst.length;n++)o.push(_(t.breakdown_assoc_lst[n].product_id));e.all(o).then(function(e){r.resolve(a(t,e))},function(e){r.reject(e)})}return r.promise}function _(t){u.start("search sp by product_id: "+t);var r=e.defer(),o=l.get(),n=l.get_pouch_view_name(i.VIEW_BY_PRODUCT_ID);return o.query(n,{key:t}).then(function(e){if(0==e.rows.length)r.resolve(null),u.stop();else if(e.rows.length>1)r.reject("multiple product found for 1 product_id "+t),u.stop();else{var o=e.rows[0].value;c(o).then(function(e){r.resolve(e),u.stop()},function(e){r.reject(e),u.stop()})}}),r.promise}function d(t){u.start("search sp by doc_id: "+t);
var r=e.defer(),o=l.get();return o.get(t).then(function(e){c(e).then(function(e){r.resolve(e),u.stop()},function(e){r.reject(e),u.stop()})},function(e){r.reject("Bug: can not find sp by doc_id in local database. Click void to try again."),u.stop()}),r.promise}function p(t){u.start("search for sku: "+t);var r=e.defer(),o=[],n=[],s=l.get(),a=l.get_pouch_view_name(i.VIEW_BY_SKU);return s.query(a,{key:t}).then(function(t){for(var s=0;s<t.rows.length;s++){var i=t.rows[s].value;n.push(c(i))}e.all(n).then(function(e){for(var t=0;t<e.length;t++)o.push(e[t]);r.resolve(o),u.stop()},function(e){r.reject(e),u.stop()})}),r.promise}return{by_sp_doc_id:d,by_product_id:_,by_sku:p}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["model.report","model.group","model.product","share.util"]),mod.factory("model.store_product.Store_product",["$injector","share.util.number",function(e,t){function r(e,t,r,o,s,i,u,l,a,c,_,d,p,m,g,f,h,v,b,k,y,x){this.id=e,this.product_id=t,this.store_id=r,this.name=o,this.price=n(s),this.value_customer_price=n(i),this.crv=n(u),this.is_taxable=l,this.is_sale_report=a,this.p_type=c,this.p_tag=_,this.cost=n(d),this.vendor=p,this.buydown=n(m),this.product=g,this.group_lst=f,this.breakdown_assoc_lst=h,this.kit_assoc_lst=v,this.sp_doc_id=b,this.sp_doc_rev=k,this.cur_stock=y,this.report_lst=x}function o(e,t){for(var r=null,o=0;o<t.length;o++)if(t[o].id==e){r=t[o];break}return r}function n(e){return null==e?null:parseFloat(e)}function s(e,t){if(null!==e&&void 0!==e){if(!e.is_kit())return e[t];for(var r=0,o=0;o<e.breakdown_assoc_lst.length;o++){var n=e.breakdown_assoc_lst[o];r+=s(n.breakdown,t)*n.qty}return r=parseFloat(r.toFixed(2))}}function i(t){var o=[];if(void 0!=t.report_lst){var n=e.get("model.report.Report");o=t.report_lst.map(n.build)}var s=[];if(void 0!=t.group_lst){var u=e.get("model.group.Group");s=t.group_lst.map(u.build)}var l=null;if(void 0!=t.product){var a=e.get("model.product.Product");l=a.build(t.product)}var c=[];if(void 0!=t.breakdown_assoc_lst&&0!=t.breakdown_assoc_lst.length){var _=e.get("model.store_product.Kit_breakdown_assoc");c=t.breakdown_assoc_lst.map(_.build)}var d=[];return void 0!=t.kit_assoc_lst&&0!=t.breakdown_assoc_lst.length&&(d=t.kit_assoc_lst.map(i)),new r(t.id,t.product_id,t.store_id,t.name,t.price,t.value_customer_price,t.crv,t.is_taxable,t.is_sale_report,t.p_type,t.p_tag,t.cost,t.vendor,t.buydown,l,s,c,d,null,null,t.cur_stock,o)}return r.prototype={constructor:r,get_offline_create_sku:function(){return this.is_create_offline?this.product.prod_sku_assoc_lst[0].sku_str:null},is_instantiate_offline:function(){return null!==this.get_rev()},get_rev:function(){return this.sp_doc_rev},is_create_offline:function(){return null===this.product_id},is_kit:function(){return null!==this.breakdown_assoc_lst&&void 0!==this.breakdown_assoc_lst&&0!=this.breakdown_assoc_lst.length},get_crv:function(){return s(this,"crv")},get_cost:function(){return s(this,"cost")},get_buydown:function(){return s(this,"buydown")},get_my_sku_assoc_lst:function(){for(var e=[],t=0;t<this.product.prod_sku_assoc_lst.length;t++){var r=this.product.prod_sku_assoc_lst[t],o=r.store_lst.indexOf(this.store_id);o!=-1&&e.push(r)}return e},get_ancestor_lst:function(){if(0===this.kit_assoc_lst.length)return[];for(var e=[],t=0;t<this.kit_assoc_lst.length;t++)for(var r=this.kit_assoc_lst[t],n=r.get_ancestor_lst(),s=0;s<n.length;s++)null==o(n[s].id,e)&&e.push(n[s]);return e},get_decendent_lst:function(){if(0==this.breakdown_assoc_lst.length)return[];for(var e=[],t=0;t<this.breakdown_assoc_lst.length;t++){var r=this.breakdown_assoc_lst[t].breakdown,n=r.get_decendent_lst();null==o(r.id,e)&&e.push(r);for(var s=0;s<n.length;s++)null==o(n[s].breakdown.id,e)&&e.push(n[s].breakdown)}return e},is_breakdown_can_be_add:function(e){var t=e.get_decendent_lst();t.push(e);var r=this.get_ancestor_lst();r.push(this);for(var n=0;n<t.length;n++){var s=t[n];if(null!=o(s.id,r))return!1}return!0},_get_b4_tax_price:function(){return this.price+this.get_crv()-this.get_buydown()},get_markup:function(){var e=this.get_cost();if(null===e||void 0===e)return null;var r=this.get_crv();null!==r&&void 0!==r||(r=0);var o=100*(this._get_b4_tax_price()-e-r)/e;return t.round_float_1_decimal(o)},get_group_count:function(){return this.group_lst.length},get_profit:function(){return void 0===this.sale?void 0:this.sale*(this._get_b4_tax_price()-this.get_cost())}},r.build=i,r}]),mod.factory("model.store_product.Kit_breakdown_assoc",["$injector",function(e){function t(e,t,r){this.id=e,this.breakdown=t,this.qty=r}return t.build=function(r){var o=e.get("model.store_product.Store_product"),n=o.build(r.breakdown);return new t(r.id,n,r.qty)},t}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.ui","share.validation.number"]),mod.factory("model.store_product.prompt",["$modal","$http","$q","model.store_product.search.online.single","model.store_product.Store_product","share.ui.alert","model.store_product.type_tag_util",function(e,t,r,o,n,s,i){var u='<button id="sp_app/service/prompt/suggest/main/name" ng-click="sp.name=get_suggest_main(\'name\').value" type="button" class="btn btn-primary">{{get_suggest_main(\'name\').value}}</button>',l='<button  id="sp_app/service/prompt/suggest/extra/name" ng-disabled="!is_many_suggestion(\'name\')" type="button" class="btn btn-primary dropdown-toggle"><span class="caret"></span></button type="button"><ul class="dropdown-menu" role="menu"><li ng-repeat="extra in get_suggest_extra(\'name\')|orderBy:\'percent\':true"><a ng-click="sp.name=extra.value" href="#">{{extra.value}} - ({{extra.percent}}%)</a></li></ul>',a='<div ng-hide="is_no_suggestion(\'name\')" class="btn-group" dropdown>'+u+l+"</div>",c='<div class="form-group"><label class="col-sm-4 control-label" >Name:</label><div class="col-sm-8"><input id="sp_app/service/prompt/name_txt" name="product_name" ng-model="sp.name" type="text" size="45" required>'+a+'<label class="error" ng-show="form.product_name.$error.required">require</label></div></div>',_='<button id="sp_app/service/prompt/suggest/main/price" ng-click="sp.price=get_suggest_main(\'price\')" type="button" class="btn btn-primary">{{get_suggest_main(\'price\')|currency}}</button>',d='<button id="sp_app/service/prompt/suggest/extra/price" ng-disabled="!is_many_suggestion(\'price\')" type="button" class="btn btn-primary dropdown-toggle"><span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="extra in get_suggest_extra(\'price\')|orderBy:\'valueOf()\'"><a ng-click="sp.price=extra" href="#">{{extra|currency}}</a></li></ul>',p='<div ng-hide="is_no_suggestion(\'price\')" class="btn-group" dropdown>'+_+d+"</div>",m='<div class="form-group"><label class="col-sm-4 control-label">Price:</label><div class="col-sm-8"><input id="sp_app/service/prompt/price_txt" name="price" ng-model="sp.price" valid-float="gt0" required>'+p+'<label class="error" ng-show="form.price.$error.required">require</label><label class="error" ng-show="form.price.$error.validFloat">invalid</label></div></div>',g='<button id="sp_app/service/prompt/suggest/main/crv" ng-click="sp.crv=get_suggest_main(\'crv\').value" type="button" class="btn btn-primary">{{get_suggest_main(\'crv\').value|currency}}</button>',f='<button id="sp_app/service/prompt/suggest/extra/crv" ng-disabled="!is_many_suggestion(\'crv\')" type="button" class="btn btn-primary dropdown-toggle"><span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="extra in get_suggest_extra(\'crv\')|orderBy:\'percent\':true"><a ng-click="sp.crv=extra.value" href="#">{{extra.value|currency}} - ({{extra.percent}}%)</a></li></ul>',h='<div ng-hide="is_no_suggestion(\'crv\')" class="btn-group" dropdown>'+g+f+"</div>",v='<div class="form-group"><label class="col-sm-4 control-label">Crv:</label><div class="col-sm-8"><input id="sp_app/service/prompt/crv_txt" name="crv" ng-model="sp.crv" ng-disabled="{{sp.is_kit()}}" valid-float="gte0" >'+h+'<label class="error" ng-show="form.crv.$invalid">invalid</label></div></div>',b='<button id="sp_app/service/prompt/suggest/main/is_taxable" ng-click="sp.is_taxable=get_suggest_main(\'is_taxable\').value" type="button" class="glyphicon btn btn-primary"'+" ng-class=\"get_suggest_main('is_taxable').value ? 'glyphicon-check' : 'glyphicon-unchecked'\"><span>({{get_suggest_main('is_taxable').percent}}%)</span></button>",k='<button id="sp_app/service/prompt/suggest/extra/is_taxable" ng-click="sp.is_taxable=!get_suggest_main(\'is_taxable\').value" type="button" class="glyphicon btn btn-primary"'+" ng-class=\"!get_suggest_main('is_taxable').value ? 'glyphicon-check' : 'glyphicon-unchecked'\"><span>({{100 - get_suggest_main('is_taxable').percent}}%)</span></button>",y='<div ng-hide="is_no_suggestion(\'is_taxable\')" class="btn-group" dropdown>'+b+k+"</div>",x='<div class="form-group"><label class="col-sm-4 control-label">Taxable:</label><div class="col-sm-8"><input id="sp_app/service/prompt/is_taxable_check" ng-model="sp.is_taxable" type="checkbox">'+y+"</div></div>",w='<button id="sp_app/service/prompt/suggest/main/cost" ng-click="sp.cost=get_suggest_main(\'cost\')" type="button" class="btn btn-primary">{{get_suggest_main(\'cost\')|currency}}</button>',$='<button id="sp_app/service/prompt/suggest/extra/cost" ng-disabled="!is_many_suggestion(\'cost\')" type="button" class="btn btn-primary dropdown-toggle"><span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="extra in get_suggest_extra(\'cost\')|orderBy:\'valueOf()\'"><a ng-click="sp.cost=extra" href="#">{{extra|currency}}</a></li><a ng-click="sp.cost=sp.cost" href="#">{{sp.cost|currency}}</a></li></ul>',T='<div ng-hide="is_no_suggestion(\'cost\')" class="btn-group" dropdown>'+w+$+"</div>",S='<div class="form-group"><label class="col-sm-4 control-label">Cost:</label><div class="col-sm-8"><input id="sp_app/service/prompt/cost_txt" name="cost" ng-model="sp.cost" ng-disabled="{{sp.is_kit()}}" valid-float="gt0"><label ng-show="sp.get_markup()!== null && sp.get_markup()!== NaN"> markup: {{sp.get_markup()}}%</label>'+T+'<label class="error" ng-show="form.cost.$invalid">invalid</label></div></div>',E='<div class="form-group"><label class="col-sm-4 control-label">Sale report:</label><div class="col-sm-8"><input id="sp_app/service/prompt/is_sale_report_check" ng-model="sp.is_sale_report" type="checkbox"></div></div>',C='<div class="form-group"><label class="col-sm-4 control-label">Vendor:</label><div class="col-sm-8"><input id="sp_app/service/prompt/vendor_txt" ng-model="sp.vendor" type="text"></div></div>',q='<div class="form-group"><label class="col-sm-4 control-label">Buydown:</label><div class="col-sm-8"><input id="sp_app/service/prompt/buydown_txt" name="buydown" ng-disabled="{{sp.is_kit()}}" ng-model="sp.buydown" valid-float="gte0"}}"><label class="error" ng-show="form.buydown.$invalid">invalid</label></div></div>',O='<div class="form-group"><label class="col-sm-4 control-label">value customer price:</label><div class="col-sm-8"><input id="sp_app/service/prompt/value_customer_price_txt" name="value_customer_price" ng-model="sp.value_customer_price" valid-float="gt0" /><label class="error" ng-show="form.value_customer_price.$invalid">invalid</label></div></div>',j='<div ng-show="is_create_new_sp()" class="form-group"><label class="col-sm-4 control-label">Sku:</label><div class="col-sm-8"><input id="sp_app/service/prompt/sku_txt" name="sku" ng-model="sku" ng-disabled="can_not_change_sku()" type="text" ng-required="is_create_new_sp()"><label class="error" ng-show="form.sku.$error.required">require</label></div></div>',U='<div id="sp_app/service/prompt/dialog" class="modal-header"><h3 class="modal-title">{{calculate_title()}}</h3></div><div class="modal-body"><form name="form" novalidate role="form"><div class="form-horizontal" >'+c+m+v+x+S+"<hr>"+E+"<div ng-include=\"'model.store_product.prompt.template_type_tag.html'\"></div>"+C+q+O+j+'</div></form></div><div class="modal-footer"><button id="sp_app/service/prompt/duplicate_from_btn" class="btn btn-primary btn-float-left" ng-click="duplicate_from()" ng-show="original_sp===null" type="button">duplicate from</button><button id="sp_app/service/prompt/cancel_btn" class="btn btn-warning" ng-click="cancel()" type="button">cancel</button><button ng-disabled="is_unchange()" class="btn btn-primary" ng-click="reset()" type="button">reset</button><button id="sp_app/service/prompt/ok_btn" ng-disabled="is_unchange()||form.$invalid" class="btn btn-success" ng-click="ok()" type="button">ok</button></div>',I=function(e,t,r,u,l,a,c,_){e.suggest_product=l,e.duplicate_sp=a,e.original_sku=c,e.original_sp=u,initial_blank_sp=new n,initial_blank_sp.is_sale_report=!0,initial_blank_sp.is_taxable=!1,e.sku=c,e.sp=angular.copy(u),null==e.sp&&(null==e.duplicate_sp?e.sp=angular.copy(initial_blank_sp):e.sp=angular.copy(e.duplicate_sp)),!angular.equals(e.sp,initial_blank_sp)&&e.sp.is_kit()&&(e.sp.crv=e.sp.get_crv(),e.sp.cost=e.sp.get_cost(),e.sp.buydown=e.sp.get_buydown()),e._suggest_main_name=null,e._suggest_main_crv=null,e._suggest_main_is_taxable=null,e._suggest_main_price=null,e._suggest_main_cost=null,e._suggest_extra_name=null,e._suggest_extra_crv=null,e._suggest_extra_is_taxable=null,e._suggest_extra_price=null,e._suggest_extra_cost=null,null!==e.suggest_product&&(e._suggest_main_name=e.suggest_product.get_suggest_main("name"),e._suggest_main_crv=e.suggest_product.get_suggest_main("crv"),e._suggest_main_is_taxable=e.suggest_product.get_suggest_main("is_taxable"),e._suggest_main_price=e.suggest_product.get_suggest_main("price"),e._suggest_main_cost=e.suggest_product.get_suggest_main("cost"),e._suggest_extra_name=e.suggest_product.get_suggest_extra("name"),e._suggest_extra_crv=e.suggest_product.get_suggest_extra("crv"),e._suggest_extra_is_taxable=e.suggest_product.get_suggest_extra("is_taxable"),e._suggest_extra_price=e.suggest_product.get_suggest_extra("price"),e._suggest_extra_cost=e.suggest_product.get_suggest_extra("cost")),e.lookup_type_tag=_.filter(function(e){return null!=e.p_type&&null!=e.p_tag}),e.lookup_type=function(){return i.get_type_lst(e.lookup_type_tag)},e.lookup_tag=function(t){return i.get_tag_lst(e.lookup_type_tag,t)},e.update_selected_type_tag=function(){null!=e.selected_type_tag?(e.sp.p_type=e.selected_type_tag.p_type,e.sp.p_tag=e.selected_type_tag.p_tag):(e.sp.p_type=null,e.sp.p_tag=null)},e.get_suggest_main=function(t){return"name"===t?e._suggest_main_name:"crv"===t?e._suggest_main_crv:"is_taxable"===t?e._suggest_main_is_taxable:"price"===t?e._suggest_main_price:"cost"===t?e._suggest_main_cost:void 0},e.get_suggest_extra=function(t){return"name"===t?e._suggest_extra_name:"crv"===t?e._suggest_extra_crv:"is_taxable"===t?e._suggest_extra_is_taxable:"price"===t?e._suggest_extra_price:"cost"===t?e._suggest_extra_cost:void 0},e.is_no_suggestion=function(t){return null===e.get_suggest_main(t)},e.is_many_suggestion=function(t){if(null===e.suggest_product)return!1;var r=e.suggest_product.get_suggest_extra(t);return null!=r&&r.length>1},e.reset=function(){null==e.original_sp?null==e.duplicate_sp?e.sp=angular.copy(initial_blank_sp):e.sp=angular.copy(e.duplicate_sp):e.sp=angular.copy(e.original_sp),e.sku=angular.copy(e.original_sku)},e.is_unchange=function(){var t=angular.equals(e.original_sku,e.sku),r=void 0;return r=null==e.original_sp?null==e.duplicate_sp?angular.equals(e.sp,initial_blank_sp):angular.equals(e.sp,e.duplicate_sp):angular.equals(e.sp,e.original_sp),r&&t},e.can_not_change_sku=function(){return null==e.duplicate_sp},e.is_create_new_sp=function(){return null==e.original_sp},e.calculate_title=function(){return null!=e.suggest_product?"Add: "+e.suggest_product.name:null!=e.duplicate_sp?"Duplicate: "+e.duplicate_sp.name:null==e.original_sp?"Sku not found. Create new product":"Edit: "+e.original_sp.name},e.duplicate_from=function(){o().then(function(t){e.sp.name=t.name,e.sp.price=t.price,e.sp.crv=t.crv,e.sp.is_taxable=t.is_taxable,e.sp.cost=t.cost,e.sp.is_sale_report=t.is_sale_report,e.sp.p_type=t.p_type,e.sp.p_tag=t.p_tag,e.sp.vendor=t.vendor,e.sp.buydown=t.buydown,e.sp.value_customer_price=t.value_customer_price},function(e){s(e)})},e.cancel=function(){t.dismiss("_cancel_")},e.ok=function(){t.close({sku:e.sku,sp:e.sp})}};return I.$inject=["$scope","$modalInstance","$filter","original_sp","suggest_product","duplicate_sp","original_sku","lookup_type_tag"],function(t,o,n,s,u){var l=e.open({template:U,controller:I,backdrop:"static",size:"lg",resolve:{original_sp:function(){return t},suggest_product:function(){return o},duplicate_sp:function(){return n},original_sku:function(){return s},lookup_type_tag:function(){var e=r.defer();return u?e.resolve(i.get_cache()):e.resolve(i.get()),e.promise}}});return l.result}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.type_tag_util",["$rootScope","$q","model.store_product.rest_type_tag",function(e,t,r){var o=void 0,n=function(e,t){for(var r=[],o=0;o<e.length;o++){var n=e[o];n.p_type===t&&r.push(n.p_tag)}return r},s=function(e){for(var t=[],r=0;r<e.length;r++){var o=e[r];t.indexOf(o.p_type)===-1&&t.push(o.p_type)}return t},i=function(){return o},u=function(){return void 0===o?r():t.when(o)};return e.$on("type_tag_downloaded_from_server",function(e,t){o=t}),e.$on("type_tag_uploaded_to_server",function(e,t){if(void 0!==o){var r=s(o);if(r.indexOf(t.p_type)===-1)o.push(t);else{var i=n(o,t.p_type);i.indexOf(t.p_tag)===-1&&o.push(t)}}}),{get_type_lst:s,get_tag_lst:n,get_cache:i,get:u}}]);var mod=angular.module("model.non_inventory");mod.factory("model.non_inventory.Non_inventory",[function(){function e(e,t,r,o,n){this.name=e,this.price=t,this.is_taxable=r,this.crv=o,this.cost=n}return e.prototype={constructor:e,get_b4_tax_price:function(){var e=this.price+this.crv;return e},get_product_tax:function(e){var t=0;return this.is_taxable&&(t=this.get_b4_tax_price()*e/100),t},get_otd_price:function(e){return this.get_b4_tax_price()+this.get_product_tax(e)}},e}]);var mod=angular.module("model.group");mod.requires.push.apply(mod.requires,["share.ui","share.offline_db_util"]),mod.controller("model.group.execute.controller",["$scope","$modalInstance","$http","share.ui.alert","model.group.Group","model.group.rest","share.offline_db_util","group",function(e,t,r,o,n,s,i,u){e.group=u,e.option={},e.checkbox_click=function(t){var r="enable_"+t,o=e[r];o===!1?delete e.option[t]:"is_taxable"===t||"is_sale_report"===t?e.option[t]=!1:"price"===t||(e.option[t]=null)},e.is_option_empty=function(){for(key in e.option)if(e.option.hasOwnProperty(key))return!1;return!0},e.ok=function(){s.execute_item(e.group.id,e.option).then(function(t){i.download_product(!1).then(function(){e.group=n.build(t),o("execute is complete successfully","info","green"),e.option={},e.enable_price=!1,e.enable_crv=!1,e.enable_is_taxable=!1,e.enable_cost=!1,e.enable_is_sale_report=!1,e.enable_p_tag=!1,e.enable_p_tag=!1,e.enable_vendor=!1,e.enable_buydown=!1,e.enable_value_customer_price=!1},function(e){o(e)})},function(e){o(e)})},e.exit=function(){t.dismiss("_cancel_")}}]);var mod=angular.module("model.group");mod.factory("model.group.execute",["$modal","$templateCache","model.group.rest",function(e,t,r){return function(o){var n=e.open({template:t.get("model.group.execute.main.html"),controller:"model.group.execute.controller",size:"lg",resolve:{group:function(){return r.get_item(o)}}});return n}}]);var mod=angular.module("model.product");mod.controller("model.product.network_product.controller",["$scope","share_setting",function(e,t){function r(e){var t=!1;return 0!==e.get_sp_lst().length&&(t=void 0!==e.get_sp_lst()[0].sale),t}e.share_setting=t,e.init=function(t){e.network_product=t,e.network_product_summary_lbl_class="col-xs-4 control-label",e.network_product_summary_value_class="col-xs-8 form-control-static",e.suggest_extra_crv=e.network_product.get_suggest_extra("crv"),e.suggest_extra_name=e.network_product.get_suggest_extra("name"),e.is_sale_data=r(t),e.cur_sort_column="get_cost()",e.cur_sort_desc=!1,e.column_click=function(t){e.cur_sort_column==t?e.cur_sort_desc=!e.cur_sort_desc:(e.cur_sort_column=t,e.cur_sort_desc=!1)},e.get_sort_class=function(t){return t==e.cur_sort_column?"glyphicon glyphicon-arrow-"+(e.cur_sort_desc?"down":"up"):""}},e.$on("network_product_is_updated",function(t,r){e.init(r)})}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.rest_crud",["$http","$rootScope","$q","model.store_product.Store_product",function(e,t,r,o){var n=function(e,r){var n=o.build(e),s={p_type:n.p_type,p_tag:n.p_tag};t.$emit("type_tag_uploaded_to_server",s),r.resolve(n)},s=function(t,o){var s=r.defer();return e({url:"/sp/insert_new_sp_angular",method:"POST",data:{sku_str:o,sp:JSON.stringify(t)}}).then(function(e){n(e.data,s)},function(e){null!==e.data&&void 0!==e.data&&e.data.indexOf("duplicate key value violates unique constraint")!==-1&&e.data.indexOf("Key (name, store_id)=")!==-1?s.reject(t.name+" is existed. Please select another name"):s.reject(e)}),s.promise},i=function(t,o,s){var i=r.defer();return e({url:"/sp/sp_insert_old_angular",method:"POST",data:{product_id:t,sku_str:o,sp:JSON.stringify(s)}}).then(function(e){n(e.data,i)},function(e){null!==e.data&&void 0!==e.data&&e.data.indexOf("duplicate key value violates unique constraint")!==-1&&e.data.indexOf("Key (name, store_id)=")!==-1?i.reject(s.name+" is existed. Please select another name"):i.reject(e)}),i.promise},u=function(t){var o=r.defer();return e({url:"/sp/update_sp_angular",method:"POST",data:{sp:JSON.stringify(t)}}).then(function(e){n(e.data,o)},function(e){o.reject(e)}),o.promise};return{insert_new:s,insert_old:i,update:u}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["model.product"]),mod.factory("model.store_product.rest_search",["$q","$http","model.store_product.Store_product","model.product.Product",function(e,t,r,o){function n(o){var n=e.defer();return t({url:"/sp/search_by_product_id",method:"GET",params:{product_id:o}}).then(function(e){var t=r.build(e.data);n.resolve(t)},function(e){n.reject(e)}),n.promise}function s(o,n){var s=e.defer();if(o=o.trim(),0==o.length)return s.reject("error: name search is empty"),s.promise;var i=o.split(" ");return i.length>2?(s.reject("error: search 2 words maximum"),s.promise):(t({url:"/sp/search_by_name_angular",method:"GET",params:{name_str:o,after:n}}).then(function(e){s.resolve(e.data.map(r.build))},function(e){s.reject(e)}),s.promise)}function i(n){if(n=n.trim(),0==n.length)return e.reject("error: sku is empty");if(n.indexOf(" ")>=0)return e.reject("error: sku cannot contain space");var s=e.defer();return t({url:"/sp/search_by_sku_angular",method:"GET",params:{sku_str:n}}).then(function(e){var t={prod_store__prod_sku__1_1:e.data.prod_store__prod_sku__1_1.map(r.build),prod_store__prod_sku__1_0:e.data.prod_store__prod_sku__1_0.map(r.build),prod_store__prod_sku__0_0:e.data.prod_store__prod_sku__0_0.map(o.build)};s.resolve(t)},function(e){s.reject(e)}),s.promise}function u(o,n){var s=o.split(" ");if(s.length>2)return e.reject("2 words search max");var i=e.defer();return t({url:"/sp/search_by_name_sku_angular",method:"GET",params:{search_str:o,after:n}}).then(function(e){i.resolve(e.data.map(r.build))},function(e){i.reject(e)}),i.promise}return{by_id:n,by_name:s,by_sku:i,by_name_sku:u}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.rest_sku",["$http","$q","model.store_product.Store_product",function(e,t,r){return{add_sku:function(o,n){var s=t.defer();return e({url:"/sp/sku_add_angular",method:"POST",data:{product_id:o,sku_str:n}}).then(function(e){s.resolve(r.build(e.data))},function(e){s.reject(e)}),s.promise},delete_sku:function(o,n){var s=t.defer();return e({url:"/sp/sku_assoc_delete_angular",method:"POST",data:{product_id:o,sku_str:n}}).then(function(e){s.resolve(r.build(e.data))},function(e){s.reject(e)}),s.promise}}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.rest_type_tag",["$rootScope","$http","$q",function(e,t,r){return function(){var o=r.defer();return t({url:"/sp/get_lookup_type_tag",method:"GET"}).then(function(t){e.$emit("type_tag_downloaded_from_server",t.data),o.resolve(t.data)},function(e){o.reject(e)}),o.promise}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.ui","model.product"]),mod.factory("model.store_product.sku_not_found_handler",["$http","$q","model.store_product.sku_not_found_handler.create.new","model.store_product.sku_not_found_handler.create.old","model.store_product.rest_sku","model.store_product.sku_not_found_handler.select_suggestion","share.ui.alert","model.store_product.Store_product","model.product.Product",function(e,t,r,o,n,s,i,u,l){return function(e,a,c){var _=t.defer();return s(e,a,c).then(function(e){if(null===e)r(c).then(function(e){_.resolve(e)},function(e){_.reject(e)});else if(e instanceof u){var t=e;n.add_sku(t.product_id,c).then(function(e){_.resolve(e)},function(e){_.reject(e)})}else if(e instanceof l){var s=e;o(s,c).then(function(e){_.resolve(e)},function(e){_.reject(e)})}else i("Bug: Unexpected select option:"+e.constructor.name)},function(e){_.reject(e)}),_.promise}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.ui"]),mod.factory("model.store_product.search.online.infinite_scroll_handler",["$q","model.store_product.rest_search",function(e,t){return function(r,o,n,s){if(r.infinite_scroll_reach_the_end)return e.when();if(void 0===r.infinite_scroll_busy)r.infinite_scroll_busy=!1;else if(r.infinite_scroll_busy===!0)return e.when();var i=e.defer(),u=s.length;r.infinite_scroll_busy=!0;var l;return l=n?t.by_name:t.by_name_sku,l(o,u).then(function(e){s.push.apply(s,e),r.infinite_scroll_reach_the_end=0===e.length,r.infinite_scroll_busy=!1,i.resolve()},function(e){i.reject(e)}),i.promise}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.create.new",["$http","$q","model.store_product.prompt","model.store_product.rest_crud",function(e,t,r,o){return function(e){var n=t.defer();return r(null,null,null,e,!1).then(function(t){o.insert_new(t.sp,e).then(function(e){n.resolve(e)},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.create.old",["$http","$q","model.store_product.prompt","model.store_product.rest_crud",function(e,t,r,o){return function(e,n){var s=t.defer();return r(null,e,null,n,!1).then(function(t){o.insert_old(e.product_id,n,t.sp).then(function(e){s.resolve(e)},function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.select_suggestion",["$modal","$q","model.store_product.sku_not_found_handler.select_suggestion.store_product","model.store_product.sku_not_found_handler.select_suggestion.product",function(e,t,r,o){return function(e,n,s){var i=t.defer();return 0===e.length&&0===n.length?i.resolve(null):0!==n.length?r(e,n,s).then(function(e){i.resolve(e)},function(e){i.reject(e)}):o(e,n,s).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.util"]),mod.controller("model.store_product.search.online.multiple.controller",["$scope","$modalInstance","model.store_product.rest_search","share.util.misc","model.store_product.search.online.infinite_scroll_handler",function(e,t,r,o,n){e.message="",e.sp_lst="",e.result_sp_lst=[],e.infinite_scroll_reach_the_end=!1,e.is_blur_infinite_scroll_triggerer_textbox=!1,e.search_str="",e.ok=function(){t.close(e.result_sp_lst)},e.is_sp_selected=function(t){return null!=o.get_item_from_lst_base_on_id(t.id,e.result_sp_lst)},e.reset=function(){e.result_sp_lst=[]},e.toggle_select=function(t){e.is_sp_selected(t)?e.remove(t):e.result_sp_lst.push(t)},e.remove=function(t){for(var r=null,o=0;o<e.result_sp_lst.length;o++)if(t.id==e.result_sp_lst[o].id){r=o;break}e.result_sp_lst.splice(r,1)},e.search=function(){if(e.search_str=e.search_str.trim(),0==e.search_str.length)return e.sp_lst=[],void(e.message="");var t=0;e.infinite_scroll_reach_the_end=!1,r.by_name_sku(e.search_str,t).then(function(t){e.sp_lst=t,0==e.sp_lst.length?e.message="no result for '"+e.search_str+"'":(e.message="",e.is_blur_infinite_scroll_triggerer_textbox=!0)},function(t){e.message=t})},e.cancel=function(){t.dismiss("_cancel_")},e.infinite_scroll_handler=function(){""!==e.search_str&&n(e,e.search_str,!1,e.sp_lst)}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.search.online.multiple",["$modal","$templateCache",function(e,t){return function(){var r=e.open({template:t.get("model.store_product.search.online.multiple.template.html"),controller:"model.store_product.search.online.multiple.controller",size:"lg"});return r.result}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.ui"]),mod.controller("model.store_product.search.online.single.controller",["$scope","$modalInstance","$http","model.store_product.rest_search","share.ui.alert","model.store_product.search.online.infinite_scroll_handler",function(e,t,r,o,n,s){e.message="",e.sp_lst="",e.infinite_scroll_reach_the_end=!1,e.search_str="",e.is_blur_infinite_scroll_triggerer_textbox=!1,e.select=function(e){t.close(e)},e.cancel=function(){t.dismiss("_cancel_")},e.search=function(t){if(e.search_str=e.search_str.trim(),0===e.search_str.length)return e.sp_lst=[],void(e.message="");var r=0;e.infinite_scroll_reach_the_end=!1,o.by_name_sku(e.search_str,r).then(function(t){e.sp_lst=t,0==e.sp_lst.length?e.message="no result for '"+e.search_str+"'":(e.message="",e.is_blur_infinite_scroll_triggerer_textbox=!0)},function(t){e.message=t})},e.infinite_scroll_handler=function(){""!==e.search_str&&s(e,e.search_str,!1,e.sp_lst)}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.search.online.single",["$modal","$templateCache",function(e,t){return function(){var r=e.open({template:t.get("model.store_product.search.online.single.template.html"),controller:"model.store_product.search.online.single.controller",size:"lg"});return r.result}}]);var mod=angular.module("model.store_product");mod.controller("model.store_product.sku_not_found_handler.select_suggestion.product.controller",["$scope","$modalInstance","$injector","model.store_product.sku_not_found_handler.select_suggestion.product.confirm","product_lst","my_sp_lst","sku",function(e,t,r,o,n,s,i){e.product_lst=n,e.my_sp_lst=s,e.sku=i,e.cancel=function(){t.dismiss("_cancel_")},e.select_product=function(e){o(e,n,s,i).then(function(e){t.close(e)},function(e){t.dismiss(e)})},e.select_sp=function(){var e=r.get("model.store_product.sku_not_found_handler.select_suggestion.store_product");e(n,s,i).then(function(e){t.close(e)},function(e){t.dismiss(e)})},e.create_new_product=function(){t.close(null)}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.select_suggestion.product",["$modal","$templateCache",function(e,t){return function(r,o,n){var s=e.open({template:t.get("model.store_product.sku_not_found_handler.select_suggestion.product.template.html"),controller:"model.store_product.sku_not_found_handler.select_suggestion.product.controller",size:"lg",backdrop:"static",resolve:{product_lst:function(){return r},my_sp_lst:function(){return o},sku:function(){return n}}});return s.result}}]);var mod=angular.module("model.store_product");mod.controller("model.store_product.sku_not_found_handler.select_suggestion.store_product.controller",["$scope","$modalInstance","$injector","share.ui.confirm","product_lst","my_sp_lst","sku",function(e,t,r,o,n,s,i){e.product_lst=n,e.my_sp_lst=s,e.sku=i,e.cancel=function(){t.dismiss("_cancel_");
},e.return_sp=function(e){o("Confirm: adding "+i+" sku to "+e.name+" ?").then(function(){t.close(e)})},e.select_product=function(){var e=r.get("model.store_product.sku_not_found_handler.select_suggestion.product");e(n,s,i).then(function(e){t.close(e)},function(e){t.dismiss(e)})},e.create_new_product=function(){t.close(null)}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.select_suggestion.store_product",["$modal","$templateCache",function(e,t){return function(r,o,n){var s=e.open({template:t.get("model.store_product.sku_not_found_handler.select_suggestion.store_product.template.html"),controller:"model.store_product.sku_not_found_handler.select_suggestion.store_product.controller",size:"lg",backdrop:"static",resolve:{product_lst:function(){return r},my_sp_lst:function(){return o},sku:function(){return n}}});return s.result}}]);var mod=angular.module("model.store_product");mod.controller("model.store_product.sku_not_found_handler.select_suggestion.product.confirm.controller",["$scope","$modalInstance","$injector","share_setting","network_product","product_lst","my_sp_lst","sku",function(e,t,r,o,n,s,i,u){e.network_product=n,e.share_setting=o,e.cancel=function(){t.dismiss("_cancel_")},e.return_product=function(){t.close(n)},e.select_product=function(){var e=r.get("model.store_product.sku_not_found_handler.select_suggestion.product");e(s,i,u).then(function(e){t.close(e)},function(e){t.dismiss(e)})}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.select_suggestion.product.confirm",["$modal","$templateCache",function(e,t){return function(r,o,n,s){var i=e.open({template:t.get("model.store_product.sku_not_found_handler.select_suggestion.product.confirm.template.html"),controller:"model.store_product.sku_not_found_handler.select_suggestion.product.confirm.controller",size:"lg",backdrop:"static",resolve:{network_product:function(){return r},product_lst:function(){return o},my_sp_lst:function(){return n},sku:function(){return s}}});return i.result}}]);var mod=angular.module("app.construct_app_setting",["model.mix_match","model.store"]);mod.factory("app.construct_app_setting",["model.mix_match.Mix_match","model.store.Store",function(e,t){return function(r){"string"==typeof r.STORE&&(r.STORE=JSON.parse(r.STORE)),"string"==typeof r.MIX_MATCH_LST&&(r.MIX_MATCH_LST=JSON.parse(r.MIX_MATCH_LST)),"string"==typeof r.PAYMENT_TYPE_LST&&(r.PAYMENT_TYPE_LST=JSON.parse(r.PAYMENT_TYPE_LST)),"string"==typeof r.SHORTCUT_LST&&(r.SHORTCUT_LST=JSON.parse(r.SHORTCUT_LST));var o={STORE:t.build(r.STORE),STORE_ID:r.STORE_ID,TAX_RATE:r.TAX_RATE,COUCH_SERVER_URL:r.COUCH_SERVER_URL,STORE_DB_PREFIX:r.STORE_DB_PREFIX,MIX_MATCH_LST:r.MIX_MATCH_LST.map(e.build),PAYMENT_TYPE_LST:r.PAYMENT_TYPE_LST,SHORTCUT_LST:r.SHORTCUT_LST,SHORTCUT_ROW_COUNT:r.SHORTCUT_ROW_COUNT,SHORTCUT_COLUMN_COUNT:r.SHORTCUT_COLUMN_COUNT,STORE_PRODUCT_DOCUMENT_TYPE:r.STORE_PRODUCT_DOCUMENT_TYPE,RECEIPT_DOCUMENT_TYPE:r.RECEIPT_DOCUMENT_TYPE,STATIC_URL:r.STATIC_URL,MAX_RECEIPT_SNOOZE_1:30,MAX_RECEIPT_SNOOZE_2:60,MAX_RECEIPT:200,VIEW_BY_PRODUCT_ID:r.VIEW_BY_PRODUCT_ID,VIEW_BY_SKU:r.VIEW_BY_SKU,VIEW_BY_D_TYPE:r.VIEW_BY_D_TYPE};return o}}]);var mod=angular.module("app.saleApp");mod.requires.push.apply(mod.requires,["ui.bootstrap","infinite-scroll","blockUI","share.util.csrf","share.filter","share.directive","share.menu","app.saleApp.partial"]),mod.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self"])}]);var app=angular.module("app.saleApp");app.requires.push.apply(app.requires,["share.ui"]),app.controller("app.saleApp.controller",["$scope","app.saleApp.init_db","share.ui.alert",function(e,t,r){e.message="hello world from sale app!",t().then(function(){},function(e){r(e)})}]);var mod=angular.module("app.saleApp");mod.requires.push.apply(mod.requires,["model.receipt","share.offline_db_util"]),mod.factory("app.saleApp.init_db",["$q","model.receipt.push","model.receipt.dao","model.store_product.dao","share_setting","share.offline_db_util",function(e,t,r,o,n,s){function i(){var t=e.defer();console.log("build view index: starting ...");var n=o.by_sku("build_sku_index"),s=o.by_product_id("build_product_id_index"),i=r.get_receipt_lst();return e.all([n,s,i]).then(function(){console.log("build view index: completed."),t.resolve()},function(e){t.reject(e)}),t.promise}return function(){var r=e.defer();return t().then(function(e){if(null!==e&&0!==e.offline_product_count)r.resolve();else{var t=null===e;s.download_product(t).then(function(){i().then(function(){r.resolve()},function(e){r.reject(e)})},function(e){r.reject(e)})}},function(e){r.reject(e)}),r.promise}}]);var mod=angular.module("app.saleApp");mod.requires.push.apply(mod.requires,["app.construct_app_setting"]),mod.value("share_setting",_GLOBAL_SETTING_),mod.run(["app.construct_app_setting","share_setting",function(e,t){var r=e(t);for(var o in r)t[o]=r[o]}]);