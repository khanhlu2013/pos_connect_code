var mod=angular.module("app.productApp",[]),mod=angular.module("app.saleApp",[]),mod=angular.module("model.group",[]),mod=angular.module("model.mix_match",[]),mod=angular.module("model.non_inventory",[]);angular.module("model.product",[]);var mod=angular.module("model.receipt",[]),mod=angular.module("model.report",[]),mod=angular.module("model.store",[]);angular.module("model.store_product",[]);var mod=angular.module("share.menu",[]),mod=angular.module("share.ui",[]),mod=angular.module("share.util",[]);!function(e){function t(t){try{e.module(t)}catch(n){return!1}return!0}function n(e,n,r){function o(){e.$on("$locationChangeStart",function(e){n.$_blockLocationChange&&n.state().blockCount>0&&e.preventDefault()}),e.$on("$locationChangeSuccess",function(){n.$_blockLocationChange=r.blockBrowserNavigation})}if(r.blockBrowserNavigation)if(t("ngRoute"))var s=e.$on("$viewContentLoaded",function(){s(),o()});else o()}var r=e.module("blockUI",[]);r.config(["$provide","$httpProvider",function(e,t){e.decorator("$exceptionHandler",["$delegate","$injector",function(e,t){var n,r;return function(o,s){if(r=r||t.get("blockUIConfig"),r.resetOnException)try{n=n||t.get("blockUI"),n.instances.reset()}catch(l){console.log("$exceptionHandler",o)}e(o,s)}}]),t.interceptors.push("blockUIHttpInterceptor")}]),r.run(["$document","blockUIConfig","$templateCache",function(e,t,n){t.autoInjectBodyBlock&&e.find("body").attr("block-ui","main"),t.template&&(t.templateUrl="$$block-ui-template$$",n.put(t.templateUrl,t.template))}]),r.config(["$provide",function(e){e.decorator("$location",o)}]);var o=["$delegate","blockUI","blockUIConfig",function(t,n,r){function o(e){var r=t[e];t[e]=function(){var e=r.apply(t,arguments);return e===t&&(n.$_blockLocationChange=!1),e}}if(r.blockBrowserNavigation){n.$_blockLocationChange=!0;var s=["url","path","search","hash","state"];e.forEach(s,o)}return t}];r.directive("blockUiContainer",["blockUIConfig","blockUiContainerLinkFn",function(e,t){return{scope:!0,restrict:"A",templateUrl:e.templateUrl,compile:function(e){return t}}}]).factory("blockUiContainerLinkFn",["blockUI","blockUIUtils",function(e,t){return function(e,t,n){var r=t.inheritedData("block-ui");if(!r)throw new Error("No parent block-ui service instance located.");e.state=r.state()}}]),r.directive("blockUi",["blockUiCompileFn",function(e){return{scope:!0,restrict:"A",compile:e}}]).factory("blockUiCompileFn",["blockUiPreLinkFn",function(e){return function(t,n){return t.append('<div block-ui-container class="block-ui-container"></div>'),{pre:e}}}]).factory("blockUiPreLinkFn",["blockUI","blockUIUtils","blockUIConfig",function(e,t,r){return function(o,s,l){s.hasClass("block-ui")||s.addClass(r.cssClass),l.$observe("blockUiMessageClass",function(e){o.$_blockUiMessageClass=e});var a=l.blockUi||"_"+o.$id,i=e.instances.get(a);if("main"===a)n(o,i,r);else{var c=s.inheritedData("block-ui");c&&(i._parent=c)}o.$on("$destroy",function(){i.release()}),i.addRef(),o.$_blockUiState=i.state(),o.$watch("$_blockUiState.blocking",function(e){s.attr("aria-busy",!!e),s.toggleClass("block-ui-visible",!!e)}),o.$watch("$_blockUiState.blockCount > 0",function(e){s.toggleClass("block-ui-active",!!e)});var u=l.blockUiPattern;if(u){var p=t.buildRegExp(u);i.pattern(p)}s.data("block-ui",i)}}]),r.constant("blockUIConfig",{templateUrl:"angular-block-ui/angular-block-ui.ng.html",delay:250,message:"Loading ...",autoBlock:!0,resetOnException:!0,requestFilter:e.noop,autoInjectBodyBlock:!0,cssClass:"block-ui block-ui-anim-fade",blockBrowserNavigation:!1}),r.factory("blockUIHttpInterceptor",["$q","$injector","blockUIConfig","$templateCache",function(e,t,n,r){function o(){a=a||t.get("blockUI")}function s(e){n.autoBlock&&e&&!e.$_noBlock&&e.$_blocks&&(o(),e.$_blocks.stop())}function l(t){try{s(t.config)}catch(n){console.log("httpRequestError",n)}return e.reject(t)}var a;return{request:function(e){if(n.autoBlock&&("GET"!=e.method||!r.get(e.url))){var t=n.requestFilter(e);t===!1?e.$_noBlock=!0:(o(),e.$_blocks=a.instances.locate(e),e.$_blocks.start(t))}return e},requestError:l,response:function(e){return e&&s(e.config),e},responseError:l}}]),r.factory("blockUI",["blockUIConfig","$timeout","blockUIUtils","$document",function(t,n,r,o){function s(s){var i,u=this,p={id:s,blockCount:0,message:t.message,blocking:!1},d=[];this._id=s,this._refs=0,this.start=function(s){function c(){i=null,p.blocking=!0}s=s||{},e.isString(s)?s={message:s}:e.forEach(a,function(e){if(s[e])throw new Error("The property "+e+" is reserved for the block state.")}),e.extend(p,s),p.blockCount>0?p.message=s.message||p.message||t.message:p.message=s.message||t.message,p.blockCount++;var d=e.element(o[0].activeElement);d.length&&r.isElementInBlockScope(d,u)&&(u._restoreFocus=d[0],n(function(){u._restoreFocus&&u._restoreFocus!==l[0]&&u._restoreFocus.blur()})),i||0===t.delay?0===t.delay&&c():i=n(c,t.delay)},this._cancelStartTimeout=function(){i&&(n.cancel(i),i=null)},this.stop=function(){p.blockCount=Math.max(0,--p.blockCount),0===p.blockCount&&u.reset(!0)},this.isBlocking=function(){return p.blocking},this.message=function(e){p.message=e},this.pattern=function(e){return void 0!==e&&(u._pattern=e),u._pattern},this.reset=function(t){if(u._cancelStartTimeout(),p.blockCount=0,p.blocking=!1,u._restoreFocus&&(!o[0].activeElement||o[0].activeElement===l[0])){try{u._restoreFocus.focus()}catch(r){!function(){var e=u._restoreFocus;n(function(){if(e)try{e.focus()}catch(t){}},100)}()}u._restoreFocus=null}try{t&&e.forEach(d,function(e){e()})}finally{d.length=0}},this.done=function(e){d.push(e)},this.state=function(){return p},this.addRef=function(){u._refs+=1},this.release=function(){--u._refs<=0&&c.instances._destroy(u)}}var l=o.find("body"),a=["id","blockCount","blocking"],i=[];i.get=function(e){if(!isNaN(e))throw new Error("BlockUI id cannot be a number");var t=i[e];return t||(t=i[e]=new s(e),i.push(t)),t},i._destroy=function(t){if(e.isString(t)&&(t=i[t]),t){t.reset();var n=r.indexOf(i,t);i.splice(n,1),delete i[t.state().id]}},i.locate=function(e){var t=[];r.forEachFnHook(t,"start"),r.forEachFnHook(t,"stop");for(var n=i.length;n--;){var o=i[n],s=o._pattern;s&&s.test(e.url)&&t.push(o)}return 0===t.length&&t.push(c),t},r.forEachFnHook(i,"reset");var c=i.get("main");return c.addRef(),c.instances=i,c}]),r.factory("blockUIUtils",function(){var t=e.element,n={buildRegExp:function(e){var t,n=e.match(/^\/(.*)\/([gim]*)$/);if(!n)throw Error("Incorrect regular expression format: "+e);return t=new RegExp(n[1],n[2])},forEachFn:function(e,t,n){for(var r=e.length;r--;){var o=e[r];o[t].apply(o,n)}},forEachFnHook:function(e,t){e[t]=function(){n.forEachFn(this,t,arguments)}},isElementInBlockScope:function(e,t){for(var n=e.inheritedData("block-ui");n;){if(n===t)return!0;n=n._parent}return!1},findElement:function(e,r,o){var s=null;if(r(e))s=e;else{var l;l=o?e.parent():e.children();for(var a=l.length;!s&&a--;)s=n.findElement(t(l[a]),r,o)}return s},indexOf:function(e,t,n){for(var r=n||0,o=e.length;r<o;r++)if(e[r]===t)return r;return-1}};return n}),e.module("blockUI").run(["$templateCache",function(e){e.put("angular-block-ui/angular-block-ui.ng.html",'<div class="block-ui-overlay"></div><div class="block-ui-message-container" aria-live="assertive" aria-atomic="true"><div class="block-ui-message" ng-class="$_blockUiMessageClass">{{ state.message }}</div></div>')}])}(angular);var mod;mod=angular.module("infinite-scroll",[]),mod.value("THROTTLE_MILLISECONDS",null),mod.directive("infiniteScroll",["$rootScope","$window","$interval","THROTTLE_MILLISECONDS",function(e,t,n,r){return{scope:{infiniteScroll:"&",infiniteScrollContainer:"=",infiniteScrollDistance:"=",infiniteScrollDisabled:"=",infiniteScrollUseDocumentBottom:"=",infiniteScrollListenForEvent:"@"},link:function(o,s,l){var a,i,c,u,p,d,_,m,g,f,h,b,v,k,y,x,w,$,T;return T=angular.element(t),k=null,y=null,c=null,u=null,h=!0,$=!1,w=null,i=!1,f=function(e){return e=e[0]||e,isNaN(e.offsetHeight)?e.document.documentElement.clientHeight:e.offsetHeight},b=function(e){if(e[0].getBoundingClientRect&&!e.css("none"))return e[0].getBoundingClientRect().top+v(e)},v=function(e){return e=e[0]||e,isNaN(window.pageYOffset)?e.document.documentElement.scrollTop:e.ownerDocument.defaultView.pageYOffset},g=function(){var t,r,l,a,p;return u===T?(t=f(u)+v(u[0].document.documentElement),l=b(s)+f(s)):(t=f(u),r=0,void 0!==b(u)&&(r=b(u)),l=b(s)-r+f(s)),$&&(l=f((s[0].ownerDocument||s[0].document).documentElement)),a=l-t,p=a<=f(u)*k+1,p?(c=!0,y?o.$$phase||e.$$phase?o.infiniteScroll():o.$apply(o.infiniteScroll):void 0):(i&&n.cancel(i),c=!1)},x=function(e,t){var r,o,s;return s=null,o=0,r=function(){var t;return o=(new Date).getTime(),n.cancel(s),s=null,e.call(),t=null},function(){var l,a;return l=(new Date).getTime(),a=t-(l-o),a<=0?(clearTimeout(s),n.cancel(s),s=null,o=l,e.call()):s?void 0:s=n(r,a,1)}},null!=r&&(g=x(g,r)),o.$on("$destroy",function(){if(u.unbind("scroll",g),null!=w)return w(),w=null}),_=function(e){return k=parseFloat(e)||0},o.$watch("infiniteScrollDistance",_),_(o.infiniteScrollDistance),d=function(e){if(y=!e,y&&c)return c=!1,g()},o.$watch("infiniteScrollDisabled",d),d(o.infiniteScrollDisabled),m=function(e){return $=e},o.$watch("infiniteScrollUseDocumentBottom",m),m(o.infiniteScrollUseDocumentBottom),a=function(e){if(null!=u&&u.unbind("scroll",g),u=e,null!=e)return u.bind("scroll",g)},a(T),o.infiniteScrollListenForEvent&&(w=e.$on(o.infiniteScrollListenForEvent,g)),p=function(e){if(null!=e&&0!==e.length){if(e instanceof HTMLElement?e=angular.element(e):"function"==typeof e.append?e=angular.element(e[e.length-1]):"string"==typeof e&&(e=angular.element(document.querySelector(e))),null!=e)return a(e);throw new Exception("invalid infinite-scroll-container attribute.")}},o.$watch("infiniteScrollContainer",p),p(o.infiniteScrollContainer||[]),null!=l.infiniteScrollParent&&a(angular.element(s.parent())),null!=l.infiniteScrollImmediateCheck&&(h=o.$eval(l.infiniteScrollImmediateCheck)),i=n(function(){if(h)return g()},0)}}}]),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.group.manage.html",'<div class="modal-header"><div class="modal-title"><h3>manage group</h3></div></div>\n\n<div class="modal-body">\n    <button id="group_app/service/manage/add_btn" ng-click="add_group()" class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span></button>\n    <input type="text" ng-model="local_filter.name" placeHolder="local filter">\n    <table ng-hide="group_lst.length == 0" class="table table-hover table-bordered table-condensed table-striped">\n        <tr>\n            <th>group</th>\n            <th>execute</th>\n            <th>delete</th>\n            <th>edit</th>\n        </tr>\n\n        <tr ng-repeat="group in group_lst | filter:local_filter">\n            <td>{{group.name}}</td>\n            <td class="alncenter"><button id="model.group.manage.template.execute_btn" ng-click="execute_group(group.id)" class="btn btn-primary"><span class="glyphicon glyphicon-play"></span></button></td> \n            <td class="alncenter"><button id="model.group.manage.template.delete_btn" ng-click="delete_group(group)" class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span></button></td>\n            <td class="alncenter"><button id="model.group.manage.template.edit_btn" ng-click="edit_group(group)"class="btn btn-primary"><span class="glyphicon glyphicon-pencil"></span></button></td>\n        </tr>\n    </table>\n    <pre ng-show="group_lst.length == 0">there is no group</pre>\n</div>\n\n<div class="modal-footer">\n    <button id="group_app/service/manage/exit_btn" ng-click="exit()" class="btn btn-warning"><span class="glyphicon glyphicon-remove"></span></button>\n</div>')}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.group.prompt.html",'<div class="modal-header"><h3>{{original_group.name==undefined?\'Create new group\' : \'Edit group \'+ original_group.name}}</h3></div>\n<div class="modal-body">\n    <div name="form" class="form-group">\n        <label>group name:</label>\n        <input id="group_app/service/prompt/name_txt" name="name" ng-model="group.name" type="text" focus-me={{true}} required>\n        <label class="error" ng-show="form.name.$error.required">required</label>\n    </div>\n\n    <button id="group_app/service/prompt/add_btn" ng-click="add_sp()" class="btn btn-primary"><span class="glyphicon glyphicon-plus"></span></button>\n    <table ng-hide="group.sp_lst.length == 0" class="table table-hover table-bordered table-condensed table-striped">\n        <tr>\n            <th>product</th>\n            <th>remove</th>\n        </tr>\n\n        <tr ng-repeat="sp in group.sp_lst">\n            <td>{{sp.name}}</td>\n            <td class="alncenter"><button ng-click="remove_sp(sp)"class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span></button></td>\n        </tr>\n    </table>\n    <pre ng-show="group.sp_lst.length == 0">there is no product in this group</pre>\n</div>\n<div class="modal-footer">\n    <button id="group_app/service/prompt/cancel_btn" ng-click="cancel()" class="btn btn-warning">cancel</button>\n    <button ng-disabled="is_unchange()" ng-click="reset()" class="btn btn-primary">reset</button>\n    <button id="group_app/service/prompt/ok_btn" ng-disabled="form.$invalid || is_unchange()" ng-click="ok()" class="btn btn-success">ok</button>\n</div>\n')}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.group.execute.input_form.html",'<form name="form" novalidate role="form">\n    <div class="form-horizontal" >\n        <!-- price --> \n        <div class="form-group">\n            <label class="col-sm-5 control-label">Price:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_price_check" ng-click="checkbox_click(\'price\')" ng-model="$parent.enable_price" type="checkbox"></input>\n                <input id="group_app/service/execute/price_txt" ng-disabled="!enable_price" ng-required="enable_price" ng-model="option.price" name="price" type="number" min="0.01">\n                <label ng-show="form.price.$error.required && !form.price.$error.number && !form.price.$error.min" class="error">required</label>\n                <label ng-show="form.price.$error.number" class="error">invalid number</label>\n                <label ng-show="form.price.$error.min" class="error">minimum error</label>\n            </div>\n        </div> \n        <!-- crv -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">Crv:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_crv_check" ng-click="checkbox_click(\'crv\')" ng-model="$parent.enable_crv" type="checkbox"></input>\n                <input id="group_app/service/execute/crv_txt" ng-disabled="!enable_crv" ng-model="option.crv" name="crv" type="number" min="0.01">\n                <label ng-show="form.crv.$error.number" class="error">invalid number</label>\n                <label ng-show="form.crv.$error.min" class="error">minimum error</label>\n            </div>\n        </div>\n        <!-- is_taxable -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">Tax:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_is_taxable_check" ng-click="checkbox_click(\'is_taxable\')" ng-model="$parent.enable_is_taxable" type="checkbox"></input>\n                <input id="group_app/service/execute/is_taxable_check" ng-disabled="!enable_is_taxable" ng-model="option.is_taxable" name="is_taxable" type="checkbox">\n            </div>\n        </div>\n        <!-- cost -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">Cost:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_cost_check" ng-click="checkbox_click(\'cost\')" ng-model="$parent.enable_cost" type="checkbox"></input>\n                <input id="group_app/service/execute/cost_txt" ng-disabled="!enable_cost" ng-model="option.cost" name="cost" type="number" min="0.01">\n                <label ng-show="form.cost.$error.number" class="error">invalid number</label>\n                <label ng-show="form.cost.$error.min" class="error">minimum error</label>\n            </div>\n        </div>\n        <!-- is_sale_report -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">sale report:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_is_sale_report_check" ng-click="checkbox_click(\'is_sale_report\')" ng-model="$parent.enable_is_sale_report" type="checkbox"></input>\n                <input id="group_app/service/execute/is_sale_report_check" ng-disabled="!enable_is_sale_report" ng-model="option.is_sale_report" name="is_sale_report" type="checkbox">\n            </div>\n        </div>\n        <!-- p_type -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">Type:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_p_type_check" ng-click="checkbox_click(\'p_type\')" ng-model="$parent.enable_p_type" type="checkbox"></input>\n                <input id="group_app/service/execute/p_type_txt" ng-disabled="!enable_p_type" ng-model="option.p_type" name="p_type" type="text">\n            </div>\n        </div>\n        <!-- p_tag -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">Tag:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_p_tag_check" ng-click="checkbox_click(\'p_tag\')" ng-model="$parent.enable_p_tag" type="checkbox"></input>\n                <input id="group_app/service/execute/p_tag_txt" ng-disabled="!enable_p_tag" ng-model="option.p_tag" name="p_tag" type="text">\n            </div>\n        </div>\n        <!-- vendor -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">Vendor:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_vendor_check" ng-click="checkbox_click(\'vendor\')" ng-model="$parent.enable_vendor" type="checkbox"></input>\n                <input id="group_app/service/execute/vendor_txt" ng-disabled="!enable_vendor" ng-model="option.vendor" name="vendor" type="text">\n            </div>\n        </div>\n        <!-- buydown -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">Buydown:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_buydown_check" ng-click="checkbox_click(\'buydown\')" ng-model="$parent.enable_buydown" type="checkbox"></input>\n                <input id="group_app/service/execute/buydown_txt" ng-disabled="!enable_buydown" ng-model="option.buydown" name="buydown" type="number" min="0.01">\n                <label ng-show="form.buydown.$error.number" class="error">invalid number</label>\n                <label ng-show="form.buydown.$error.min" class="error">minimum error</label>\n            </div>\n        </div>\n        <!-- value customer price -->\n        <div class="form-group">\n            <label class="col-sm-5 control-label">value_cus_price:</label>\n            <div class="col-sm-7">\n                <input id="group_app/service/execute/enable_value_customer_price_check" ng-click="checkbox_click(\'value_customer_price\')" ng-model="$parent.enable_value_customer_price" type="checkbox"></input>\n                <input id="group_app/service/execute/value_customer_price_txt" ng-disabled="!enable_value_customer_price" ng-model="option.value_customer_price" name="value_customer_price" type="number" min="0.01">\n                <label ng-show="form.value_customer_price.$error.number" class="error">invalid number</label>\n                <label ng-show="form.value_customer_price.$error.min" class="error">minimum error</label>\n            </div>\n        </div>\n    </div>\n</form>')}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.group.execute.main.html",'<div class="modal-header"><h3>{{group.name}} - execute</h3></div>\n\n<div class="modal-body">\n    <div ng-hide="group.sp_lst.length === 0">\n        <div class="col-sm-5">\n            <div ng-include=" \'model.group.execute.input_form.html\' "></div>\n            <div ng-hide="is_option_empty()">\n                <hr>\n                <h3>actions</h3>\n                <ul>\n                    <li ng-show="value!== undefined" ng-repeat="(key,value) in option">{{key}} : <span ng-class="value===null?\'error\':\'\'">{{value !== null ? value : \'empty\'}}</span></li>\n                </ul>\n            </div>  \n        </div>\n        <div class="col-sm-7">\n            <table class="table table-hover table-bordered table-condensed table-striped">\n                <tr>\n                    <th>product</th>\n                    <th>price</th>\n                    <th>crv</th>\n                    <th>tax</th>\n                    <th>cost</th>\n                </tr>\n\n                <tr ng-repeat="sp in group.sp_lst">\n                    <td>{{sp.name}}</td>\n                    <td>{{sp.price|currency}}</td>\n                    <td>{{sp.crv|currency}}</td>\n                    <td class="alncenter"><span class="glyphicon" ng-class="sp.is_taxable? \'glyphicon-check\' : \'glyphicon-unchecked\'"></span></td>\n                    <td>{{sp.cost|currency}}</td>\n                </tr>\n            </table>\n        </div>                     \n        <div class="clear"></div>\n    </div>\n    <pre id="group_app/service/execute/empty_group_warning_lbl" ng-show="group.sp_lst.length === 0" class="error">there is no product in this group</pre>\n</div>\n\n<div class="modal-footer">\n    <button id="group_app/service/execute/ok_btn" ng-disabled="is_option_empty() || form.$invalid" ng-click="ok() || group.sp_lst.length === 0" class="btn btn-success">ok</button>\n    <button id="group_app/service/execute/exit_btn" ng-click="exit()" class="btn btn-warning">exit</button>\n</div>')}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.product.network_product.detail.html",'<h3>detail</h3>\n<table class="table table-hover table-bordered table-condensed table-striped">\n    <tr>\n        <th>name</th>\n        <th>percent</th>\n    </tr>\n    <tr ng-repeat="name_stat in suggest_extra_name|orderBy:\'-percent\'">\n        <td>{{name_stat.value}}</td>\n        <td>{{name_stat.percent}}%</td>\n    </tr>\n</table>\n<table ng-hide="suggest_extra_crv.length === 0" class="table table-hover table-bordered table-condensed table-striped">\n    <tr>\n        <th>crv</th>\n        <th>percent</th>\n    </tr>\n    <tr ng-repeat="crv_stat in suggest_extra_crv|orderBy:\'-percent\'">\n        <td>{{crv_stat.value|currency}}</td>\n        <td>{{crv_stat.percent}}%</td>\n    </tr> \n</table>\n<table class="table table-hover table-bordered table-condensed table-striped">\n    <tr>\n        <th class="info" ng-click="column_click(\'get_cost()\')">cost <span ng-class="get_sort_class(\'get_cost()\')"></span></th>\n        <th class="info" ng-click="column_click(\'price\')">price <span ng-class="get_sort_class(\'price\')"></span></th>\n        <th class="info" ng-click="column_click(\'get_markup()\')">markup% <span ng-class="get_sort_class(\'get_markup()\')"></span></th>\n        <th ng-show="is_sale_data" class="info" ng-click="column_click(\'sale\')">sale <span ng-class="get_sort_class(\'sale\')"></span></th>\n        <th ng-show="is_sale_data" class="info" ng-click="column_click(\'get_profit()\')">profit <span ng-class="get_sort_class(\'get_profit()\')"></span></th>\n    </tr>\n    <tr \n        ng-repeat="sp in (network_product.get_sp_lst()|orderBy:cur_sort_column:cur_sort_desc|emptyToEnd:cur_sort_column)" \n        ng-class="sp.store_id === share_setting.STORE_ID ? \'success\' : \'\'" \n    >\n        <td class="alnright">{{sp.get_cost()|currency}}</td>\n        <td class="alnright">{{sp._get_b4_tax_price()|currency}}</td>\n        <td class="alnright">{{sp.get_markup()}}</td>\n        <td class="alnright" ng-show="is_sale_data">{{sp.sale}}</td>\n        <td class="alnright" ng-show="is_sale_data">{{sp.sale * (sp._get_b4_tax_price() - sp.get_cost()) | currency | not_show_zero}}</td>\n    </tr>\n</table>\n')}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.product.network_product.main.html",'<div id="model.product.network_product.html" ng-hide="network_product === undefined || network_product === null">\n    <div class="col-md-6">\n        <div ng-include=" \'model.product.network_product.summary.html\' "></div>\n    </div>\n    \n    <div class="col-md-6">\n        <div ng-include=" \'model.product.network_product.detail.html\' "></div>\n    </div>\n    \n    <div class="clear"></div>\n</div>')}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.product.network_product.summary.html",'<h3>average</h3>\n<div class="form-horizontal" >\n    <div class="form-group">\n        <label ng-class="network_product_summary_lbl_class">name:</label>\n        <p \n            id="product/network_product/summary/name_lbl" \n            ng-class="network_product_summary_value_class">\n                {{network_product.get_suggest_main(\'name\').value}}\n        </p>\n    </div>\n    <div class="form-group">\n        <label ng-class="network_product_summary_lbl_class">member count:</label>\n        <p \n            ng-class="network_product_summary_value_class">\n                {{network_product.get_sp_lst().length}}\n        </p>\n    </div>    \n    <div class="form-group">\n        <label ng-class="network_product_summary_lbl_class">price:</label>\n        <p \n            id="product/network_product/summary/price_lbl" \n            ng-class="network_product_summary_value_class">\n                {{network_product.get_suggest_main(\'price\')|currency}}\n        </p>\n    </div>\n    <div class="form-group">\n        <label ng-class="network_product_summary_lbl_class">tax:</label>\n        <p ng-hide="network_product.get_suggest_main(\'is_taxable\').percent === 50" ng-class="network_product_summary_value_class">\n            <span\n                id="product/network_product/summary/is_taxable/sign_span"\n                class="glyphicon"\n                ng-class="network_product.get_suggest_main(\'is_taxable\').value === true ? \'glyphicon-check\' : \'glyphicon-unchecked\'">\n            </span>\n            <span\n                id="product/network_product/summary/is_taxable/percent_span"\n                ng-hide="network_product.get_suggest_main(\'is_taxable\').percent === 100">\n                    ({{network_product.get_suggest_main(\'is_taxable\').percent}}%)\n            </span>\n        </p>\n    </div>\n    <div class="form-group">\n        <label ng-class="network_product_summary_lbl_class">crv:</label>\n        <p \n            id="product/network_product/summary/crv_lbl" \n            ng-class="network_product_summary_value_class">\n                {{network_product.get_suggest_main(\'crv\').value|currency}}\n        </p>\n    </div>\n    <div class="form-group">\n        <label ng-class="network_product_summary_lbl_class">cost:</label>\n        <p \n            id="product/network_product/summary/cost_lbl" \n            ng-class="network_product_summary_value_class">\n                {{network_product.get_suggest_main(\'cost\')|currency}}\n        </p>\n    </div>                                                            \n</div>')}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.prompt.template_name.html","<div class='form-group'>\n    <label class='col-sm-4 control-label' >Name:</label>\n    <div class='col-sm-8'>\n        <input id='sp_app/service/prompt/name_txt' name='product_name' ng-model='sp.name' type='text' size='45' required>\n        <div ng-include='model.store_product.prompt.template_name_suggestion.html'></div>\n        <label class='error' ng-show='form.product_name.$error.required'>require</label>\n    </div>\n</div>\n    ")}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.prompt.template_name_suggestion.html","<div ng-hide='is_no_suggestion(\"name\")' class='btn-group' dropdown>\n    <button\n        id='sp_app/service/prompt/suggest/main/name'\n        ng-click='sp.name=get_suggest_main(\"name\").value'\n        type='button'\n        class='btn btn-primary'>\n            {{get_suggest_main('name').value}}\n    </button>\n\n    <button\n        id='sp_app/service/prompt/suggest/extra/name'\n        ng-disabled='!is_many_suggestion(\"name\")'\n        type='button'\n        class='btn btn-primary dropdown-toggle'>\n            <span class='caret'></span>\n    </button type='button'>\n    <ul class='dropdown-menu' role='menu'>\n        <li ng-repeat='extra in get_suggest_extra(\"name\")|orderBy:\"percent\":true'>\n            <a ng-click='sp.name=extra.value' href='#'>{{extra.value}} - ({{extra.percent}}%)</a>\n        </li>\n    </ul>\n</div>")}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.prompt.template_price.html","<div class='form-group'>\n    <label class='col-sm-4 control-label'>Price:</label>\n    <div class='col-sm-8'>\n        <input \n            id='sp_app/service/prompt/price_txt' \n            name='price'\n            ng-model='sp.price' \n            valid-float='gt0'\n            required>\n        <div ng-include='model.store_product.prompt.template_price_suggestion.html'></div>\n        <label \n            class='error' \n            ng-show='form.price.$error.required'>\n            require\n        </label>\n        <label \n            class='error' \n            ng-show='form.price.$error.validFloat'>\n            invalid\n        </label>\n    </div>\n</div>\n")}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.prompt.template_price_suggestion.html","<div ng-hide='is_no_suggestion(\"price\")' class='btn-group' dropdown>\n    <button\n        id='sp_app/service/prompt/suggest/main/price'\n        ng-click='sp.price=get_suggest_main(\"price\")'\n        type='button'\n        class='btn btn-primary'>\n            {{get_suggest_main(\"price\")|currency}}\n    </button>\n    <button\n        id='sp_app/service/prompt/suggest/extra/price'\n        ng-disabled='!is_many_suggestion(\"price\")'\n        type='button'\n        class='btn btn-primary dropdown-toggle'>\n            <span class='caret'></span>\n    </button>\n    <ul class='dropdown-menu' role='menu'>\n        <li ng-repeat='extra in get_suggest_extra(\"price\")|orderBy:\"valueOf()'>\n            <a ng-click='sp.price=extra' href='#'>{{extra|currency}}</a>\n        </li>\n    </ul>\n</div>\n");
}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.prompt.template_type_tag.html",'<div class="form-group">\n    <label class="col-sm-4 control-label">Type - tag:</label>\n    <div class="col-sm-8">\n        <select \n            ng-options="((item.p_type == false ? \'none\' : item.p_type) + \' - \' + (item.p_tag == false ? \'none\' : item.p_tag)) group by item.p_type for item in lookup_type_tag" \n            ng-model="selected_type_tag" ng-change="update_selected_type_tag()">\n            <option value="">-- select type tag --</option>\n        </select>\n    </div>\n</div>\n\n<div class="form-group">\n    <label class="col-sm-4 control-label">Type:</label>\n    <div class="col-sm-8">\n        <input \n            id="sp_app/service/prompt/p_type_txt" \n            ng-model="sp.p_type" \n            typeahead="item for item in lookup_type() | filter:$viewValue | limitTo:8"\n            type="text">\n    </div>\n</div>\n\n<div class="form-group">\n    <label class="col-sm-4 control-label">Tag:</label>\n    <div class="col-sm-8">\n        <input \n            id="sp_app/service/prompt/p_tag_txt" \n            ng-model="sp.p_tag" \n            typeahead="item for item in lookup_tag(sp.p_type) | filter:$viewValue | limitTo:8"\n            type="text">\n    </div>\n</div>')}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.search.online.multiple.template.html","<div class='modal-header'>\n    <h3 class='modal-title'>search</h3>\n</div>\n<div class='modal-body'>\n    <input\n        id='sp_ll_app/service/search/name_sku_online_dlg/multiple/search_txt'\n        type='text'\n        ng-model='search_str'\n        ng-enter='search()'\n        placeholder='name/sku'\n        focus-me='{{true}}'\n        blur-me='is_blur_infinite_scroll_triggerer_textbox'\n    >\n    <input ng-model='local_filter' type='text' placeholder='local filter'>\n    <div>\n        <div \n            class='col-sm-6' \n            style=\"overflow:auto;min-height:650px;max-height:650px\" \n            id=\"inifnite_scroll_parent_sp_search_multiple\">\n            <div ng-hide='message.length == 0'>\n                <pre>{{message}}</pre>\n            </div>\n            <table \n                class='table table-hover table-bordered table-condensed table-striped' \n                infinite-scroll-container=\"'#inifnite_scroll_parent_sp_search_multiple'\"\n                infinite-scroll=\"infinite_scroll_handler()\" \n                infinite-scroll-distance='0'\n                infinite-scroll-parent=\"true\">\n                <tr>\n                    <th>name</th>\n                    <th>price</th>\n                    <th>select</th>          \n                </tr>\n\n                <tr \n                    id='model.store_product.search.online.multiple.search_result_lst'\n                    ng-repeat='sp_multiple in sp_lst | orderBy:\"name\" | filter:local_filter'>\n                    <td>{{sp_multiple.name}}</td>\n                    <td class='alnright'>{{sp_multiple.price | currency}}</td>\n                    <td class='alncenter'>\n                        <button \n                            id='model.store_product.search.online.multiple.search_result_lst.toggle_btn'\n                            ng-class='is_sp_selected(sp_multiple) ? \"btn-warning glyphicon-check\" : \"btn-primary glyphicon-unchecked\"' \n                            class='btn glyphicon btn-xs' \n                            ng-click='toggle_select(sp_multiple)' \n                            onclick='this.blur()'>\n                        </button>\n                    </td>\n                </tr>\n            </table>\n        </div>\n\n        <div class='col-sm-6'>\n            <table class='table table-hover table-bordered table-condensed table-striped'>\n                <tr>\n                    <th>name</th>\n                    <th>price</th>                        \n                    <th>remove</th>\n                </tr>\n\n                <tr ng-repeat='sp_select in result_sp_lst | orderBy:\"name\"'>\n                    <td>{{sp_select.name}}</td>\n                    <td class='alnright'>{{sp_select.price|currency}}</td>\n                    <td class='alncenter'>\n                        <button \n                            id='model.store_product.search.online.multiple.selected_sp_lst.remove_btn'\n                            class='btn btn-warning glyphicon glyphicon-trash' ng-click='remove(sp_select)'></button>\n                    </td>\n                </tr>\n            </table>\n        </div>\n    </div>\n    <div class='clear'></div>\n</div>\n\n<div class='modal-footer'>\n    <button\n        id='model.store_product.search.online.multiple.cancel_btn' \n        class='btn btn-warning' ng-click='cancel()'>cancel</button>\n    <button \n        id='model.store_product.search.online.multiple.reset_btn'\n        ng-disabled='result_sp_lst.length==0' \n        class='btn btn-primary' \n        ng-click='reset()'>reset</button>\n    <button \n        id='sp_ll_app/service/search/name_sku_online_dlg/multiple/ok_btn' \n        ng-disabled='result_sp_lst.length==0' \n        class='btn btn-success' \n        ng-click='ok()'>ok</button>\n</div>")}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.search.online.single.template.html","<div class='modal-header'>\n    <h3 class='modal-title'>search</h3>\n</div>\n\n<div \n    style=\"overflow:auto;min-height:650px;max-height:650px\"\n    id=\"inifnite_scroll_parent_sp_search_single\"\n    class='modal-body'>\n    <input\n        id='sp_ll_app/service/search/name_sku_online_dlg/single/search_txt'\n        type='text'\n        ng-model='search_str'\n        ng-enter='search(\"user\")'\n        placeholder='name/sku'\n        focus-me={{true}}\n        blur-me='is_blur_infinite_scroll_triggerer_textbox'>\n    <input ng-model='local_filter' type='text' placeholder='local filter'>\n    <table \n        class='table table-hover table-bordered table-condensed table-striped'\n        infinite-scroll-container=\"'#inifnite_scroll_parent_sp_search_single'\"\n        infinite-scroll=\"infinite_scroll_handler()\" \n        infinite-scroll-parent=\"true\"\n        infinite-scroll-distance='0'>\n        <tr>\n            <th>name</th>\n            <th>price</th>\n            <th>select</th>\n        </tr>\n\n        <tr ng-repeat='search_sp_single in sp_lst | filter:local_filter'>\n            <td>{{search_sp_single.name}}</td>\n            <td>{{search_sp_single.price|currency}}</td>\n            <td class='alncenter'>\n                <button \n                    class='btn btn-primary btn-xs' \n                    ng-click='select(search_sp_single)'>select\n                </button>\n            </td>\n        </tr>\n    </table>\n\n    <div ng-hide='message.length == 0'>\n        <pre>{{message}}</pre>\n    </div>        \n</div>\n\n<div class='modal-footer'>\n    <button class='btn btn-warning' ng-click='cancel()'>cancel</button>\n</div>\n")}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.sku_not_found_handler.select_suggestion.product.template.html","<div \n    class='alert alert-warning' \n    id='sp_app/service/suggest/select_product_dlg' \n    class='modal-header'>\n    <h3>sku not found - {{sku}}</h3>\n</div>\n<div class='modal-body'>\n    <h3>Option 1: </h3>\n    <div class='indent_40px'>\n        <table class='table table-hover table-bordered table-condensed table-striped'>\n            <label>add products from pos_connect network</label>\n            <tr>\n                <th>member count</th>\n                <th>name</th>\n                <th>price</th>\n                <th>crv</th>\n                <th>tax</th>\n                <th>cost</th>\n                <th>add</th>\n            </tr>\n            <tr ng-repeat=\"product in product_lst |orderBy:'-get_sp_lst().length'\">\n                <td id=\"model.store_product.sku_not_found_handler.select_suggestion.product.product_lst.member_count\">{{product.get_sp_lst().length}}</td>\n                <td id=\"model.store_product.sku_not_found_handler.select_suggestion.product.product_lst.name\">{{product.get_suggest_main('name').value}}</td>\n                <td id=\"model.store_product.sku_not_found_handler.select_suggestion.product.product_lst.price\">{{product.get_suggest_main('price')|currency}}</td>\n                <td id=\"model.store_product.sku_not_found_handler.select_suggestion.product.product_lst.crv\">{{product.get_suggest_main('crv').value|currency}}</td>\n                <td id=\"model.store_product.sku_not_found_handler.select_suggestion.product.product_lst.is_taxable\" class=\"alncenter\">\n                    <div ng-hide=\"product.get_suggest_main('is_taxable').percent === 50\">\n                        <span\n                            class='glyphicon'\n                            ng-attr-id='sp_app/service/suggest/select_product_dlg/lst/is_taxable/sign/{{product.id}}'\n                            ng-class=\"product.get_suggest_main('is_taxable').value === true ? 'glyphicon-check' : 'glyphicon-unchecked'\">\n                        </span>\n                        <span\n                            ng-attr-id='sp_app/service/suggest/select_product_dlg/lst/is_taxable/percent/{{product.id}}'\n                            ng-hide=\"product.get_suggest_main('is_taxable').percent === 100 \">\n                                ({{product.get_suggest_main('is_taxable').percent}}%)\n                        </span>\n                    </div>\n                </td>\n                <td id=\"model.store_product.sku_not_found_handler.select_suggestion.product.product_lst.cost\">{{product.get_suggest_main('cost')|currency}}</td>\n                <td class='alncenter'>\n                    <button \n                        ng-click='select_product(product)' \n                        id=\"model.store_product.sku_not_found_handler.select_suggestion.product.product_lst.select_btn\" \n                        class='btn btn-primary glyphicon glyphicon-plus'></button>\n                </td>\n            </tr>\n        </table>\n\n    </div>\n\n    <h3>Option 2:</h3>\n    <div class='indent_40px'>\n        <button \n            id='sp_app/service/suggest/select_product_dlg/create_new_product_btn' \n            ng-click='create_new_product()'\n            class='btn btn-primary'>create new product\n        </button>\n    </div>\n\n</div>\n<div class='modal-footer'>\n    <button \n        id='sp_app/service/suggest/select_product_dlg/select_sp'\n        ng-click='select_sp()'\n        ng-hide='my_sp_lst.length === 0'\n        class='btn btn-primary btn-float-left'>back\n    </button>\n    <button ng-click='cancel()' class='btn btn-warning'>cancel</button>\n</div>\n")}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.sku_not_found_handler.select_suggestion.store_product.template.html","<div id='sp_app/service/suggest/select_sp_dlg' class='modal-header'><h3>sku: {{sku}} not found</h3></div>\n<div class='modal-body'>\n    <h3>Option 1</h3>\n    <div class='indent_40px'>\n        <label>These products are <mark>already inside</mark> your database. If scanned product is found here, you can <mark>simply</mark> add sku.</label>\n        <table class='table table-hover table-bordered table-condensed table-striped'>\n            <tr>\n                <th>your product</th>\n                <th>price</th>\n                <th>taxable</th>\n                <th>crv</th>\n                <th>cost</th>\n                <th>buydown</th>\n                <th><span class='glyphicon glyphicon-plus'> sku</span></th>\n            </tr>\n            <tr ng-repeat='sp in my_sp_lst' id='model.store_product.sku_not_found_handler.select_suggestion.store_product.lst'>\n                <td>{{sp.name}}</td>\n                <td>{{sp.price | currency}}</td>\n                <td class='alncenter'><span class='glyphicon' ng-class=\"sp.is_taxable ? 'glyphicon-check' : 'glyphicon-unchecked'\"></span></td>\n                <td>{{sp.get_crv()}}</td>\n                <td>{{sp.get_cost()}}</td>\n                <td>{{sp.get_buydown()}}</td>\n                <td class='alncenter'>\n                    <button \n                        ng-click = 'return_sp(sp)' \n                        id = 'model.store_product.sku_not_found_handler.select_suggestion.store_product.lst.return_sp_btn'\n                        class = 'btn btn-primary glyphicon glyphicon-plus'> sku\n                    </button>\n                </td>\n            </tr>\n        </table>\n    </div>\n    <h3>Option 2</h3>\n    <div class='indent_40px'>\n        <label>If scanned product is <mark>not</mark> found:</label>\n        <button \n            id='sp_app/service/suggest/select_sp_dlg/create_new_product_btn' \n            ng-click='create_new_product()' \n            ng-hide='product_lst.length !== 0' \n            class='btn btn-primary'>create new product</button>\n        <button \n            id='sp_app/service/suggest/select_sp_dlg/select_product_btn' \n            ng-click='select_product()' \n            ng-hide='product_lst.length === 0' \n            class='btn btn-primary'>see network suggestion</button>\n    </div>\n</div>\n<div class='modal-footer'>\n    <button ng-click='cancel()' class='btn btn-warning'>cancel</button>\n</div>")}])}(),function(e){try{e=angular.module("app.productApp.partial")}catch(t){e=angular.module("app.productApp.partial",[])}e.run(["$templateCache",function(e){e.put("model.store_product.sku_not_found_handler.select_suggestion.product.confirm.template.html",'<div \n    id="sp_app/service/suggest/select_product_confirm_dlg" \n    class="modal-header">\n    <h3>confirm add product</h3>\n</div>\n\n<div class="modal-body">\n    <div \n        ng-controller="model.product.network_product.controller" \n        ng-init="init(network_product)" \n        ng-include=" \'model.product.network_product.main.html\' ">\n    </div>\n</div>\n\n<div class="modal-footer">\n    <button \n        id=\'model.store_product.sku_not_found_handler.select_suggestion.product.confirm.back_btn\'\n        ng-click="select_product()" \n        class="btn btn-primary btn-float-left">back\n    </button>\n    <button\n        id="sp_app/service/suggest/select_product_confirm_dlg/ok_btn" \n        ng-click="return_product()" \n        class="btn btn-success">add product\n    </button>\n    <button ng-click="cancel()" class="btn btn-warning">cancel</button>\n</div>')}])}();var mod=angular.module("share.offline_db_util",[]);mod.factory("share.offline_db_util",["$q","$rootScope","share_setting","blockUI",function(e,t,n,r){function o(){var e=n.STORE_DB_PREFIX+n.STORE_ID;return new PouchDB(e)}function s(t){var n=e.defer(),r=o();return r.get(t).then(function(e){r.remove(e).then(function(e){n.resolve(e)},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise}function l(){var t=e.defer(),r="_pouch_"+n.STORE_DB_PREFIX+n.STORE_ID,o=indexedDB.open(r);return o.onupgradeneeded=function(e){e.target.transaction.abort()},o.onsuccess=function(e){t.resolve(!0)},o.onerror=function(e){"AbortError"==e.target.error.name?(indexedDB.deleteDatabase(r),t.resolve(!1)):t.reject("error when checking db existance")},t.promise}function a(t){var n=e.defer();return t?i().then(function(e){n.resolve(e)},function(e){n.reject(e)}):l().then(function(e){e?i().then(function(e){n.resolve(e)},function(e){n.reject(e)}):n.resolve(null)},function(e){return n.reject(e)}),n.promise}function i(){var n=e.defer(),o=18,s="liquor_"+o,l=new PouchDB(s),a="https://ffireventaiduretrimarril:O7bnrIIMumwfueNuMat6SnaA@khanhlu2013ceci.cloudant.com",i=a+"/"+s;return r.start("syncing database ..."),console.log("begin syncing for store_id: "+o),PouchDB.replicate(i,l,{batch_size:200,batches_limit:10}).on("change",function(e){t.$apply(function(){var t=e.docs_written+" products synced";r.message(t)})}).on("complete",function(e){n.resolve(e),r.stop()}).on("error",function(e){t.$apply(function(){var t="there is sync error: "+e;n.reject(t),r.stop()})}),n.promise}function c(e){return e+"/"+e}return{get:o,remove_doc:s,is_exist:l,download_product:a,get_pouch_view_name:c}}]);var mod=angular.module("share.validation.number",[]);mod.directive("validFloat",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,r){var o=function(e,t){if(e=e.trim(),isNaN(e))return!1;var e=Number(e),t=n.validFloat;return""===t||("gt0"===t?e>0:"gte0"===t&&e>=0)};r.$parsers.unshift(function(e){if(null===e||0===e.trim().length)return r.$setValidity("validFloat",!0),null;var t=o(e);return r.$setValidity("validFloat",t),t?Number(e):void 0}),r.$formatters.unshift(function(e){return null===e||0===e.trim().length?r.$setValidity("validFloat",!0):r.$setValidity("validFloat",o(e)),e})}}});var mod=angular.module("share.directive",[]);mod.directive("ngEnter",function(){return function(e,t,n){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(n.ngEnter)}),t.preventDefault())})}}),mod.directive("blurMe",["$timeout","$parse",function(e,t){return{link:function(n,r,o){var s=t(o.blurMe);n.$watch(s,function(t){t===!0&&e(function(){r[0].blur()})}),r.bind("focus",function(){void 0!==s.assign&&s.assign(n,!1)})}}}]),mod.directive("focusMe",["$timeout","$parse",function(e,t){return{link:function(n,r,o){var s=t(o.focusMe);n.$watch(s,function(t){t===!0&&e(function(){r[0].focus()})}),r.bind("blur",function(){void 0!==s.assign&&n.$apply(s.assign(n,!1))})}}}]);var mod=angular.module("share.filter",[]);mod.filter("not_show_zero",function(){return function(e){return"$0.00"===e?"":"0"===e?"":0===e?"":e}}),mod.filter("emptyToEnd",function(){return function(e,t){if(angular.isArray(e)){var n=e.filter(function(e){return t.indexOf("()")!=-1?e[t.replace("()","")]():e[t]}),r=e.filter(function(e){return t.indexOf("()")!=-1?!e[t.replace("()","")]():!e[t]});return n.concat(r)}}});var mod=angular.module("share.menu");mod.requires.push.apply(mod.requires,["share.ui","model.group"]),mod.controller("share.menu.menuCtrl",["$scope","$window","share.ui.alert","share.ui.confirm","model.group.manage",function(e,t,n,r,o){e.menu_setting_group=function(){o()},e.menu_setting_store=function(){n("store settings")},e.menu_setting_mix_match=function(){n("mix match settings")},e.menu_setting_payment_type=function(){n("payment type settings")},e.menu_setting_shortcut=function(){n("shortcut")},e.menu_action_logout=function(){r("logout?").then(function(){t.location.href="/account/logout/"})}}]);var mod=angular.module("share.ui");mod.factory("share.ui.alert",["$modal",function(e){return function(t,n,r){void 0===n&&(n="alert"),void 0===r&&(r="red");var o;if("string"==typeof t){if(o=t,"_cancel_"===o||void 0===o||"backdrop click"===o||"escape key press"===o)return}else"PouchError"===t.constructor.name||"Error"===t.constructor.name?(n="Pouch error: "+t.name,o=t.message):0===t.status?o="internet is disconnected!":(n="please report ajax bug:",o="url: "+t.config.url);var s="";"green"==r?s="alert alert-success":"blue"==r?s="alert alert-info":"orange"==r?s="alert alert-warning":"red"==r&&(s="alert alert-danger");var l='<form name="form" novalidate><div id="service/ui/alert/dialog" class="modal-header '+s+'"><h3 class="modal-title">'+n+'</h3></div><div class="modal-body"><h1 id="service/ui/alert/message_lbl">'+o+'</h1></div><div class="modal-footer"><button id="service/ui/alert/ok_btn" type="submit" class="btn btn-success" ng-click="ok()">ok</button></div></form>',a=function(e,t){e.ok=function(){t.close()}};a.$inject=["$scope","$modalInstance"];e.open({template:l,controller:a,size:"md"})}}]);var mod=angular.module("share.ui");mod.factory("share.ui.confirm",["$modal",function(e){return function(t,n){null==n&&(n="warning");var r="alert alert-"+n,o='<div id="service/ui/confirm/dialog" class="modal-header '+r+'"><h3 class="modal-title">confirm</h3></div><div class="modal-body"><h1 id="service/ui/confirm/message_txt">'+t+'</h1></div><div class="modal-footer"><button id="service/ui/confirm/cancel_btn" class="btn btn-warning" ng-click="cancel()" type="button">cancel</button><button id="service/ui/confirm/ok_btn" type="submit" class="btn btn-success" ng-click="ok()">ok</button></div>',s=function(e,t){e.ok=function(){t.close()},e.cancel=function(){t.dismiss("_cancel_")}};s.$inject=["$scope","$modalInstance"];var l=e.open({template:o,controller:s,size:"md"});return l.result}}]),angular.module("share.util.csrf",[]).config(["$httpProvider",function(e){e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFToken",e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",e.defaults.withCredentials=!0;var t=function(e){var n,r,o,s,l,a,i,c="";for(n in e)if(r=e[n],r instanceof Array)for(i=0;i<r.length;++i)l=r[i],o=n+"["+i+"]",a={},a[o]=l,c+=t(a)+"&";else if(r instanceof Object)for(s in r)l=r[s],o=n+"["+s+"]",a={},a[o]=l,c+=t(a)+"&";else void 0!==r&&null!==r&&(c+=encodeURIComponent(n)+"="+encodeURIComponent(r)+"&");return c.length?c.substr(0,c.length-1):c};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]}]);var mod=angular.module("share.util");mod.factory("share.util.misc",function(){function e(e){return e.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])}function t(e,t){for(var n=null,r=0;r<t.length;r++)if(t[r].id==e){n=t[r];break}return n}return{get_unique_lst:e,get_item_from_lst_base_on_id:t}});var mod=angular.module("share.util");mod.factory("share.util.number",function(){function e(e){return parseFloat(e.toFixed(2))}function t(e){return parseFloat(e.toFixed(1))}return{round_float_1_decimal:t,round_float_2_decimal:e}});var mod=angular.module("model.group");mod.requires.push.apply(mod.requires,["model.store_product"]),mod.factory("model.group.Group",["$injector",function(e){function t(e,t,n){this.id=e,this.name=t,this.sp_lst=n}return t.build=function(n){var r=null,o=e.get("model.store_product.Store_product");return void 0!=n.sp_lst&&(r=n.sp_lst.map(o.build)),new t(n.id,n.name,r)},t}]);var mod=angular.module("model.group");mod.factory("model.group.create",["$q","model.group.prompt","model.group.rest",function(e,t,n){return function(){var r=e.defer();return t(null).then(function(e){n.create_item(e).then(function(e){r.resolve(e)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise}}]);var mod=angular.module("model.group");mod.factory("model.group.edit",["$http","$q","model.group.prompt","model.group.rest",function(e,t,n,r){return function(e){var o=t.defer();return r.get_item(e.id).then(function(e){return n(e)},function(e){o.reject(e)}).then(function(t){r.edit_item(t,e.id).then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise}}]);var mod=angular.module("model.group");mod.requires.push.apply(mod.requires,["share.ui"]),mod.factory("model.group.manage",["$modal","$templateCache","model.group.rest",function(e,t,n){return function(){var r=e.open({template:t.get("model.group.manage.html"),controller:"model.group.manage.modalCtrl",size:"lg",resolve:{group_lst:function(){return n.get_lst()}}});return r.result}}]),mod.controller("model.group.manage.modalCtrl",["$scope","$modalInstance","$rootScope","share.ui.confirm","share.ui.alert","model.group.execute","model.group.edit","model.group.create","model.group.rest","group_lst",function(e,t,n,r,o,s,l,a,i,c){e.group_lst=c,e.execute_group=function(e){s(e)},e.delete_group=function(t){r("delete "+t.name+" group?").then(function(n){n!==!1&&i.delete_item(t.id).then(function(){for(var n=null,r=0;r<e.group_lst.length;r++)if(e.group_lst[r].id===t.id){n=r;break}null===n?o("Bug: should be unreachable. can not find deleted index after success response"):e.group_lst.splice(r,1)},function(e){o(e)})})},e.add_group=function(){a().then(function(t){e.group_lst.push(t)},function(e){o(e)})},e.edit_group=function(e){l(e).then(function(t){angular.copy(t,e)},function(e){o(e)})},e.exit=function(){n.$emit("model.group.manage",e.group_lst),t.close()}}]);var mod=angular.module("model.group");mod.requires.push.apply(mod.requires,["share.ui","share.util","model.store_product"]),mod.factory("model.group.prompt",["$modal","$templateCache","share.ui.alert","share.util.misc","model.store_product.search.online.multiple",function(e,t,n,r,o){return function(s){var l=function(e,t,s){null==s&&(s={sp_lst:[]}),e.original_group=s,e.group=angular.copy(e.original_group),e.remove_sp=function(t){for(var n=0;n<e.group.sp_lst.length;n++)if(t.id==e.group.sp_lst[n].id){e.group.sp_lst.splice(n,1);break}},e.add_sp=function(){o().then(function(t){for(var n=0;n<t.length;n++)null==r.get_item_from_lst_base_on_id(t[n].id,e.group.sp_lst)&&e.group.sp_lst.push(t[n])},function(e){n(e)})},e.is_unchange=function(){return angular.equals(e.group,e.original_group)},e.reset=function(){e.group=angular.copy(e.original_group)},e.ok=function(){t.close(e.group)},e.cancel=function(){t.dismiss("_cancel_")}};l.$inject=["$scope","$modalInstance","original_group"];var a=e.open({template:t.get("model.group.prompt.html"),controller:l,size:"md",backdrop:"static",resolve:{original_group:function(){return s}}});return a.result}}]);var mod=angular.module("model.group");mod.factory("model.group.rest",["$http","$q","model.group.Group",function(e,t,n){function r(r){var o=t.defer();return e({url:"/group/get_item",method:"GET",params:{group_id:r}}).then(function(e){o.resolve(n.build(e.data))},function(e){o.reject(e)}),o.promise}function o(r,o){var s=t.defer();return e({url:"/group/update_angular",method:"POST",data:{group:JSON.stringify(r),id:o}}).then(function(e){s.resolve(n.build(e.data))},function(e){s.reject(e)}),s.promise}function s(){var r=t.defer();return e({url:"/group/get_lst",method:"GET"}).then(function(e){r.resolve(e.data.map(n.build))},function(e){r.reject(e)}),r.promise}function l(r){var o=t.defer();return e({url:"/group/insert_angular",method:"POST",data:{group:JSON.stringify(r)}}).then(function(e){o.resolve(n.build(e.data))},function(e){return t.reject(e)}),o.promise}function a(n){var o=t.defer();return r(n).then(function(t){0===t.sp_lst.length?e({url:"/group/delete_angular",method:"POST",data:{group_id:n}}).then(function(){o.resolve()},function(e){o.reject(e)}):o.reject("group must be empty to be deleted")},function(e){o.reject(e)}),o.promise}function i(r,o){var s=t.defer();return e({method:"POST",url:"/group/execute",data:{group_id:r,option:JSON.stringify(o)}}).then(function(e){s.resolve(n.build(e.data))},function(e){s.reject(e)}),s.promise}return{delete_item:a,create_item:l,get_lst:s,get_item:r,edit_item:o,execute_item:i}}]);var mod=angular.module("model.mix_match");mod.requires.push.apply(mod.requires,["model.store_product"]),mod.factory("model.mix_match.Mix_match",["model.store_product.Store_product",function(e){function t(e,t,n,r,o,s,l){this.id=e,this.name=t,this.mm_price=n,this.is_include_crv_tax=r,this.qty=o,this.sp_lst=s,this.is_disable=l}return t.build=function(n){return new t(n.id,n.name,parseFloat(n.mm_price),n.is_include_crv_tax,n.qty,n.sp_lst.map(e.build),n.is_disable)},t}]);var mod=angular.module("model.non_inventory");mod.factory("model.non_inventory.Non_inventory",[function(){function e(e,t,n,r,o){this.name=e,this.price=t,this.is_taxable=n,this.crv=r,this.cost=o}return e.prototype={constructor:e,get_b4_tax_price:function(){var e=this.price+this.crv;return e},get_product_tax:function(e){var t=0;return this.is_taxable&&(t=this.get_b4_tax_price()*e/100),t},get_otd_price:function(e){return this.get_b4_tax_price()+this.get_product_tax(e)}},e}]);var mod=angular.module("model.product");mod.factory("model.product.Prod_sku_assoc",[function(){function e(e,t,n,r){this.product_id=e,this.creator_id=t,this.store_lst=n,this.sku_str=r}return e.build=function(t){return new e(t.product_id,t.creator_id,t.store_set,t.sku_str)},e}]);var mod=angular.module("model.product");mod.requires.push.apply(mod.requires,["share.util"]),mod.factory("model.product.Product",["$injector","model.product.Prod_sku_assoc","share.util.number","share.util.misc",function(e,t,n,r){function o(e,t,n,r){this.product_id=e,this.name=t,this.sp_lst=n,this.prod_sku_assoc_lst=r}function s(e,t){for(var n=null,r=0;r<t.length;r++)if(t[r].value===e){n=t[r];break}return n}function l(e,t){for(var n=!1,r=0;r<t.length;r++)if(e.store_id===t[r]){n=!0;break}return n}function a(e){var t=r.get_unique_lst(e);return t}function i(e){if(0==e.length)return null;e.sort(function(e,t){return t-e});var t=Math.floor(e.length/2);return e.length%2?e[t]:n.round_float_2_decimal((e[t-1]+e[t])/2)}return o.prototype={constructor:o,get_sp_lst:function(e){if(null===e||void 0===e)return this.sp_lst;var t=this.prod_sku_assoc_lst.filter(function(t){return t.sku_str===e});if(0===t.length)return[];if(1!==t.length)throw Exception("Bug: product model is corrupted.");for(var n=t[0],r=n.store_lst,o=[],s=0;s<this.sp_lst.length;s++){var a=this.sp_lst[s];l(a,r)&&o.push(a)}return o},get_suggest_main:function(e){if("price"===e||"cost"===e)return i(this._get_suggest_raw_detail(e));var t=this._get_mode_statistic(e);return 0!==t.length?t[0]:null},get_suggest_extra:function(e){return"price"===e||"cost"===e?a(this._get_suggest_raw_detail(e)):this._get_mode_statistic(e)},_get_mode_statistic:function(e){if("price"===e||"cost"===e)return null;for(var t=this._get_suggest_raw_detail(e),n=[],r=0;r<t.length;r++){var o=t[r],l=s(o,n);null===l?(l={value:o,count:1,percent:null},n.push(l)):l.count+=1}for(var a=0,r=0;r<n.length;r++)a+=n[r].count;for(var r=0;r<n.length;r++)n[r].percent=Math.round(n[r].count/a*100);return n.sort(function(e,t){return t.count-e.count})},_get_suggest_raw_detail:function(e){for(var t=[],n=this.sp_lst,r=0;r<n.length;r++)if("price"==e)null!=n[r].price&&t.push(n[r].price);else if("cost"==e)null!=n[r].get_cost()&&t.push(n[r].get_cost());else if("crv"==e)null!=n[r].get_crv()&&t.push(n[r].get_crv());else if("name"==e)t.push(n[r].name);else{if("is_taxable"!=e)return null;t.push(n[r].is_taxable)}return t}},o.build=function(n){Store_product=e.get("model.store_product.Store_product");var r=null;void 0!=n.store_product_set&&(r=n.store_product_set.map(Store_product.build));var s=null;return void 0!=n.prodskuassoc_set&&(s=n.prodskuassoc_set.map(t.build)),new o(n.product_id,n.name,r,s)},o}]);var mod=angular.module("model.receipt");mod.requires.push.apply(mod.requires,["share.offline_db_util"]),mod.factory("model.receipt.dao",["$q","model.receipt.storage_adapter","share_setting","blockUI","share.offline_db_util",function(e,t,n,r,o){function s(){r.start("getting offline receipt ...");var s=e.defer();return o.is_exist().then(function(e){if(e){var l=o.get(),a=o.get_pouch_view_name(n.VIEW_BY_D_TYPE);l.query(a,{key:n.RECEIPT_DOCUMENT_TYPE}).then(function(e){for(var n=[],o=0;o<e.rows.length;o++)n.push(e.rows[o].value);s.resolve(n.map(function(e){return t.pouch_2_javascript(e)})),r.stop()},function(e){s.reject("Bug: get offline receipt has error"),r.stop()})}else s.resolve(null),r.stop()},function(e){s.reject(e),r.stop()}),s.promise}function l(n){r.start("getting offline receipt ...");var s=e.defer();return o.is_exist().then(function(e){if(e){var l=o.get();l.get(n).then(function(e){s.resolve(t.pouch_2_javascript(e)),r.stop()},function(e){s.reject(e),r.stop()})}else s.resolve(null),r.stop()},function(e){s.reject(e),r.stop()}),s.promise}function a(n,r){var s=e.defer();n.tender_ln_lst=r;var a=o.get();return a.put(t.javascript_2_pouch(n),n.doc_id,n.doc_rev).then(function(e){
l(e.id).then(function(e){s.resolve(n)},function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise}return{get_receipt_lst:s,get_item:l,adjust_receipt_tender:a}}]);var mod=angular.module("model.receipt");mod.requires.push.apply(mod.requires,["share.offline_db_util"]),mod.factory("model.receipt.push",["$http","$q","model.receipt.dao","share.offline_db_util","blockUI",function(e,t,n,r,o){function s(e,n){var o=t.defer();if(0===e.length&&0===n.length)return o.resolve(!0),o.promise;for(var s=[],l=0;l<e.length;l++)s.push(r.remove_doc(e[l]));for(var l=0;l<n.length;l++)s.push(r.remove_doc(n[l]));return t.all(s).then(function(){r.download_product(!1).then(function(){o.resolve()},function(e){o.reject(e)})},function(e){d,efer.reject(e)}),o.promise}return function(){o.start("uploading receipts ...");var r=t.defer();return n.get_receipt_lst().then(function(t){null===t?(r.resolve(null),o.stop()):0===t.length?(r.resolve({receipt_count:0,offline_product_count:0}),o.stop()):e({method:"POST",url:"/receipt/push",data:{receipt_lst:JSON.stringify(t)}}).then(function(e){var t=e.data.receipt_doc_id_lst,n=e.data.sp_doc_id_lst;s(t,n).then(function(){r.resolve({receipt_count:t.length,offline_product_count:n.length}),o.stop()},function(e){r.reject(e),o.stop()})},function(e){r.reject(e),o.stop()})},function(e){r.reject(e),o.stop()}),r.promise}}]);var mod=angular.module("model.receipt");mod.requires.push.apply(mod.requires,["share.util"]),mod.factory("model.receipt.storage_adapter",["share_setting","share.util.misc",function(e,t){function n(e){return e}function r(e){var t=null;return null!==e&&(t=new Mix_match_deal_info_stamp(e.name,e.unit_discount)),t}function o(e){var t=null;return null!==e&&(t=new Non_inventory(e.name,e.price,e.is_taxable,e.crv,e.cost)),t}function s(e){var t=null;return null!==e&&(t=new Store_product_stamp(e.sp_id,e.doc_id,e.offline_create_sku,e.name,e.price,e.value_customer_price,e.crv,e.is_taxable,e.is_sale_report,e.p_type,e.p_tag,e.cost,e.vendor,e.buydown)),t}function l(e){var t=new Receipt_ln(e.id,e.qty,e.discount,e.override_price,null,s(e.store_product_stamp),r(e.mm_deal_info_stamp),o(e.non_inventory),new Date(e.date));return t}function a(n){var r=null;null!==n.pt&&(r=t.get_item_from_lst_base_on_id(n.pt.id,e.PAYMENT_TYPE_LST));var o=new Tender_ln(n.id,r,n.amount,n.name);return o}function i(e){var t=new Receipt(e.id,new Date(e.date),e.tax_rate,e.tender_ln_lst.map(function(e){return a(e)}),e.receipt_ln_lst.map(l),e._id,e._rev);return t}function c(t){var r={id:t.id,date:t.date.toString(),tax_rate:t.tax_rate,tender_ln_lst:t.tender_ln_lst,receipt_ln_lst:t.receipt_ln_lst.map(n),d_type:e.RECEIPT_DOCUMENT_TYPE};return r}return{javascript_2_pouch:c,pouch_2_javascript:i}}]);var mod=angular.module("model.report");mod.requires.push.apply(mod.requires,["model.store_product"]),mod.factory("model.report.Report",["$injector",function(e){function t(e,t,n){this.id=e,this.name=t,this.sp_lst=n}return t.build=function(n){var r=null,o=e.get("model.store_product.Store_product");return void 0!=n.sp_lst&&(r=n.sp_lst.map(o.build)),new t(n.id,n.name,r)},t}]);var mod=angular.module("model.store");mod.factory("model.store.Store",[function(){function e(e,t,n,r,o,s,l,a,i,c,u,p,d,_,m,g,f,h){this.id=e,this.name=t,this.tax_rate=n,this.phone=r,this.street=o,this.city=s,this.state=l,this.zip_code=a,this.is_profit_information_exchange=i,this.display_is_report=c,this.display_type=u,this.display_tag=p,this.display_group=d,this.display_deal=_,this.display_vendor=m,this.display_buydown=g,this.display_vc_price=f,this.display_stock=h}return e.build=function(t){return new e(t.id,t.name,parseFloat(t.tax_rate),t.phone,t.street,t.city,t.state,t.zip_code,t.is_profit_information_exchange,t.display_is_report,t.display_type,t.display_tag,t.display_group,t.display_deal,t.display_vendor,t.display_buydown,t.display_vc_price,t.display_stock)},e}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["model.product","share.util","share.offline_db_util"]),mod.factory("model.store_product.dao",["$q","model.store_product.Store_product","model.store_product.Kit_breakdown_assoc","model.product.Product","model.product.Prod_sku_assoc","share.util.misc","share_setting","blockUI","share.offline_db_util",function(e,t,n,r,o,s,l,a,i){function c(e,l){for(var a=[],i=0;i<e.sku_lst.length;i++){var c=new o(e.product_id,null,[e.store_id],e.sku_lst[i]);a.push(c)}for(var u=new r(e.product_id,null,null,a),p=[],i=0;i<e.breakdown_assoc_lst.length;i++){var d=e.breakdown_assoc_lst[i],_=s.get_item_from_lst_base_on_property("product_id",d.product_id,l);p.push(new n(null,_,d.qty))}var m=null,_=new t(e.id,e.product_id,e.store_id,e.name,e.price,e.value_customer_price,e.crv,e.is_taxable,e.is_sale_report,e.p_type,e.p_tag,e.cost,e.vendor,e.buydown,u,null,p,m,e._id,e._rev,null,null);return _}function u(t){var n=e.defer();if(0===t.breakdown_assoc_lst.length)n.resolve(c(t,[]));else{for(var r=[],o=0;o<t.breakdown_assoc_lst.length;o++)r.push(p(t.breakdown_assoc_lst[o].product_id));e.all(r).then(function(e){n.resolve(c(t,e))},function(e){n.reject(e)})}return n.promise}function p(t){a.start("search sp by product_id: "+t);var n=e.defer(),r=i.get(),o=i.get_pouch_view_name(l.VIEW_BY_PRODUCT_ID);return r.query(o,{key:t}).then(function(e){if(0==e.rows.length)n.resolve(null),a.stop();else if(e.rows.length>1)n.reject("multiple product found for 1 product_id "+t),a.stop();else{var r=e.rows[0].value;u(r).then(function(e){n.resolve(e),a.stop()},function(e){n.reject(e),a.stop()})}}),n.promise}function d(t){a.start("search sp by doc_id: "+t);var n=e.defer(),r=i.get();return r.get(t).then(function(e){u(e).then(function(e){n.resolve(e),a.stop()},function(e){n.reject(e),a.stop()})},function(e){n.reject("Bug: can not find sp by doc_id in local database. Click void to try again."),a.stop()}),n.promise}function _(t){a.start("search for sku: "+t);var n=e.defer(),r=[],o=[],s=i.get(),c=i.get_pouch_view_name(l.VIEW_BY_SKU);return s.query(c,{key:t}).then(function(t){for(var s=0;s<t.rows.length;s++){var l=t.rows[s].value;o.push(u(l))}e.all(o).then(function(e){for(var t=0;t<e.length;t++)r.push(e[t]);n.resolve(r),a.stop()},function(e){n.reject(e),a.stop()})}),n.promise}return{by_sp_doc_id:d,by_product_id:p,by_sku:_}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["model.report","model.group","model.product","share.util"]),mod.factory("model.store_product.Store_product",["$injector","share.util.number",function(e,t){function n(e,t,n,r,s,l,a,i,c,u,p,d,_,m,g,f,h,b,v,k,y,x){this.id=e,this.product_id=t,this.store_id=n,this.name=r,this.price=o(s),this.value_customer_price=o(l),this.crv=o(a),this.is_taxable=i,this.is_sale_report=c,this.p_type=u,this.p_tag=p,this.cost=o(d),this.vendor=_,this.buydown=o(m),this.product=g,this.group_lst=f,this.breakdown_assoc_lst=h,this.kit_assoc_lst=b,this.sp_doc_id=v,this.sp_doc_rev=k,this.cur_stock=y,this.report_lst=x}function r(e,t){for(var n=null,r=0;r<t.length;r++)if(t[r].id==e){n=t[r];break}return n}function o(e){return null==e?null:parseFloat(e)}function s(e,t){if(null!==e&&void 0!==e){if(!e.is_kit())return e[t];for(var n=0,r=0;r<e.breakdown_assoc_lst.length;r++){var o=e.breakdown_assoc_lst[r];n+=s(o.breakdown,t)*o.qty}return n=parseFloat(n.toFixed(2))}}function l(t){var r=[];if(void 0!=t.report_lst){var o=e.get("model.report.Report");r=t.report_lst.map(o.build)}var s=[];if(void 0!=t.group_lst){var a=e.get("model.group.Group");s=t.group_lst.map(a.build)}var i=null;if(void 0!=t.product){var c=e.get("model.product.Product");i=c.build(t.product)}var u=[];if(void 0!=t.breakdown_assoc_lst&&0!=t.breakdown_assoc_lst.length){var p=e.get("model.store_product.Kit_breakdown_assoc");u=t.breakdown_assoc_lst.map(p.build)}var d=[];return void 0!=t.kit_assoc_lst&&0!=t.breakdown_assoc_lst.length&&(d=t.kit_assoc_lst.map(l)),new n(t.id,t.product_id,t.store_id,t.name,t.price,t.value_customer_price,t.crv,t.is_taxable,t.is_sale_report,t.p_type,t.p_tag,t.cost,t.vendor,t.buydown,i,s,u,d,null,null,t.cur_stock,r)}return n.prototype={constructor:n,get_offline_create_sku:function(){return this.is_create_offline?this.product.prod_sku_assoc_lst[0].sku_str:null},is_instantiate_offline:function(){return null!==this.get_rev()},get_rev:function(){return this.sp_doc_rev},is_create_offline:function(){return null===this.product_id},is_kit:function(){return null!==this.breakdown_assoc_lst&&void 0!==this.breakdown_assoc_lst&&0!=this.breakdown_assoc_lst.length},get_crv:function(){return s(this,"crv")},get_cost:function(){return s(this,"cost")},get_buydown:function(){return s(this,"buydown")},get_my_sku_assoc_lst:function(){for(var e=[],t=0;t<this.product.prod_sku_assoc_lst.length;t++){var n=this.product.prod_sku_assoc_lst[t],r=n.store_lst.indexOf(this.store_id);r!=-1&&e.push(n)}return e},get_ancestor_lst:function(){if(0===this.kit_assoc_lst.length)return[];for(var e=[],t=0;t<this.kit_assoc_lst.length;t++)for(var n=this.kit_assoc_lst[t],o=n.get_ancestor_lst(),s=0;s<o.length;s++)null==r(o[s].id,e)&&e.push(o[s]);return e},get_decendent_lst:function(){if(0==this.breakdown_assoc_lst.length)return[];for(var e=[],t=0;t<this.breakdown_assoc_lst.length;t++){var n=this.breakdown_assoc_lst[t].breakdown,o=n.get_decendent_lst();null==r(n.id,e)&&e.push(n);for(var s=0;s<o.length;s++)null==r(o[s].breakdown.id,e)&&e.push(o[s].breakdown)}return e},is_breakdown_can_be_add:function(e){var t=e.get_decendent_lst();t.push(e);var n=this.get_ancestor_lst();n.push(this);for(var o=0;o<t.length;o++){var s=t[o];if(null!=r(s.id,n))return!1}return!0},_get_b4_tax_price:function(){return this.price+this.get_crv()-this.get_buydown()},get_markup:function(){var e=this.get_cost();if(null===e||void 0===e)return null;var n=this.get_crv();null!==n&&void 0!==n||(n=0);var r=100*(this._get_b4_tax_price()-e-n)/e;return t.round_float_1_decimal(r)},get_group_count:function(){return this.group_lst.length},get_profit:function(){return void 0===this.sale?void 0:this.sale*(this._get_b4_tax_price()-this.get_cost())}},n.build=l,n}]),mod.factory("model.store_product.Kit_breakdown_assoc",["$injector",function(e){function t(e,t,n){this.id=e,this.breakdown=t,this.qty=n}return t.build=function(n){var r=e.get("model.store_product.Store_product"),o=r.build(n.breakdown);return new t(n.id,o,n.qty)},t}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.ui","share.validation.number"]),mod.factory("model.store_product.prompt",["$modal","$http","$q","model.store_product.search.online.single","model.store_product.Store_product","share.ui.alert","model.store_product.type_tag_util",function(e,t,n,r,o,s,l){var a='<button id="sp_app/service/prompt/suggest/main/name" ng-click="sp.name=get_suggest_main(\'name\').value" type="button" class="btn btn-primary">{{get_suggest_main(\'name\').value}}</button>',i='<button  id="sp_app/service/prompt/suggest/extra/name" ng-disabled="!is_many_suggestion(\'name\')" type="button" class="btn btn-primary dropdown-toggle"><span class="caret"></span></button type="button"><ul class="dropdown-menu" role="menu"><li ng-repeat="extra in get_suggest_extra(\'name\')|orderBy:\'percent\':true"><a ng-click="sp.name=extra.value" href="#">{{extra.value}} - ({{extra.percent}}%)</a></li></ul>',c='<div ng-hide="is_no_suggestion(\'name\')" class="btn-group" dropdown>'+a+i+"</div>",u='<div class="form-group"><label class="col-sm-4 control-label" >Name:</label><div class="col-sm-8"><input id="sp_app/service/prompt/name_txt" name="product_name" ng-model="sp.name" type="text" size="45" required>'+c+'<label class="error" ng-show="form.product_name.$error.required">require</label></div></div>',p='<button id="sp_app/service/prompt/suggest/main/price" ng-click="sp.price=get_suggest_main(\'price\')" type="button" class="btn btn-primary">{{get_suggest_main(\'price\')|currency}}</button>',d='<button id="sp_app/service/prompt/suggest/extra/price" ng-disabled="!is_many_suggestion(\'price\')" type="button" class="btn btn-primary dropdown-toggle"><span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="extra in get_suggest_extra(\'price\')|orderBy:\'valueOf()\'"><a ng-click="sp.price=extra" href="#">{{extra|currency}}</a></li></ul>',_='<div ng-hide="is_no_suggestion(\'price\')" class="btn-group" dropdown>'+p+d+"</div>",m='<div class="form-group"><label class="col-sm-4 control-label">Price:</label><div class="col-sm-8"><input id="sp_app/service/prompt/price_txt" name="price" ng-model="sp.price" valid-float="gt0" required>'+_+'<label class="error" ng-show="form.price.$error.required">require</label><label class="error" ng-show="form.price.$error.validFloat">invalid</label></div></div>',g='<button id="sp_app/service/prompt/suggest/main/crv" ng-click="sp.crv=get_suggest_main(\'crv\').value" type="button" class="btn btn-primary">{{get_suggest_main(\'crv\').value|currency}}</button>',f='<button id="sp_app/service/prompt/suggest/extra/crv" ng-disabled="!is_many_suggestion(\'crv\')" type="button" class="btn btn-primary dropdown-toggle"><span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="extra in get_suggest_extra(\'crv\')|orderBy:\'percent\':true"><a ng-click="sp.crv=extra.value" href="#">{{extra.value|currency}} - ({{extra.percent}}%)</a></li></ul>',h='<div ng-hide="is_no_suggestion(\'crv\')" class="btn-group" dropdown>'+g+f+"</div>",b='<div class="form-group"><label class="col-sm-4 control-label">Crv:</label><div class="col-sm-8"><input id="sp_app/service/prompt/crv_txt" name="crv" ng-model="sp.crv" ng-disabled="{{sp.is_kit()}}" valid-float="gte0" >'+h+'<label class="error" ng-show="form.crv.$invalid">invalid</label></div></div>',v='<button id="sp_app/service/prompt/suggest/main/is_taxable" ng-click="sp.is_taxable=get_suggest_main(\'is_taxable\').value" type="button" class="glyphicon btn btn-primary"'+" ng-class=\"get_suggest_main('is_taxable').value ? 'glyphicon-check' : 'glyphicon-unchecked'\"><span>({{get_suggest_main('is_taxable').percent}}%)</span></button>",k='<button id="sp_app/service/prompt/suggest/extra/is_taxable" ng-click="sp.is_taxable=!get_suggest_main(\'is_taxable\').value" type="button" class="glyphicon btn btn-primary"'+" ng-class=\"!get_suggest_main('is_taxable').value ? 'glyphicon-check' : 'glyphicon-unchecked'\"><span>({{100 - get_suggest_main('is_taxable').percent}}%)</span></button>",y='<div ng-hide="is_no_suggestion(\'is_taxable\')" class="btn-group" dropdown>'+v+k+"</div>",x='<div class="form-group"><label class="col-sm-4 control-label">Taxable:</label><div class="col-sm-8"><input id="sp_app/service/prompt/is_taxable_check" ng-model="sp.is_taxable" type="checkbox">'+y+"</div></div>",w='<button id="sp_app/service/prompt/suggest/main/cost" ng-click="sp.cost=get_suggest_main(\'cost\')" type="button" class="btn btn-primary">{{get_suggest_main(\'cost\')|currency}}</button>',$='<button id="sp_app/service/prompt/suggest/extra/cost" ng-disabled="!is_many_suggestion(\'cost\')" type="button" class="btn btn-primary dropdown-toggle"><span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li ng-repeat="extra in get_suggest_extra(\'cost\')|orderBy:\'valueOf()\'"><a ng-click="sp.cost=extra" href="#">{{extra|currency}}</a></li><a ng-click="sp.cost=sp.cost" href="#">{{sp.cost|currency}}</a></li></ul>',T='<div ng-hide="is_no_suggestion(\'cost\')" class="btn-group" dropdown>'+w+$+"</div>",S='<div class="form-group"><label class="col-sm-4 control-label">Cost:</label><div class="col-sm-8"><input id="sp_app/service/prompt/cost_txt" name="cost" ng-model="sp.cost" ng-disabled="{{sp.is_kit()}}" valid-float="gt0"><label ng-show="sp.get_markup()!== null && sp.get_markup()!== NaN"> markup: {{sp.get_markup()}}%</label>'+T+'<label class="error" ng-show="form.cost.$invalid">invalid</label></div></div>',C='<div class="form-group"><label class="col-sm-4 control-label">Sale report:</label><div class="col-sm-8"><input id="sp_app/service/prompt/is_sale_report_check" ng-model="sp.is_sale_report" type="checkbox"></div></div>',E='<div class="form-group"><label class="col-sm-4 control-label">Vendor:</label><div class="col-sm-8"><input id="sp_app/service/prompt/vendor_txt" ng-model="sp.vendor" type="text"></div></div>',q='<div class="form-group"><label class="col-sm-4 control-label">Buydown:</label><div class="col-sm-8"><input id="sp_app/service/prompt/buydown_txt" name="buydown" ng-disabled="{{sp.is_kit()}}" ng-model="sp.buydown" valid-float="gte0"}}"><label class="error" ng-show="form.buydown.$invalid">invalid</label></div></div>',O='<div class="form-group"><label class="col-sm-4 control-label">value customer price:</label><div class="col-sm-8"><input id="sp_app/service/prompt/value_customer_price_txt" name="value_customer_price" ng-model="sp.value_customer_price" valid-float="gt0" /><label class="error" ng-show="form.value_customer_price.$invalid">invalid</label></div></div>',U='<div ng-show="is_create_new_sp()" class="form-group"><label class="col-sm-4 control-label">Sku:</label><div class="col-sm-8"><input id="sp_app/service/prompt/sku_txt" name="sku" ng-model="sku" ng-disabled="can_not_change_sku()" type="text" ng-required="is_create_new_sp()"><label class="error" ng-show="form.sku.$error.required">require</label></div></div>',I='<div id="sp_app/service/prompt/dialog" class="modal-header"><h3 class="modal-title">{{calculate_title()}}</h3></div><div class="modal-body"><form name="form" novalidate role="form"><div class="form-horizontal" >'+u+m+b+x+S+"<hr>"+C+"<div ng-include=\"'model.store_product.prompt.template_type_tag.html'\"></div>"+E+q+O+U+'</div></form></div><div class="modal-footer"><button id="sp_app/service/prompt/duplicate_from_btn" class="btn btn-primary btn-float-left" ng-click="duplicate_from()" ng-show="original_sp===null" type="button">duplicate from</button><button id="sp_app/service/prompt/cancel_btn" class="btn btn-warning" ng-click="cancel()" type="button">cancel</button><button ng-disabled="is_unchange()" class="btn btn-primary" ng-click="reset()" type="button">reset</button><button id="sp_app/service/prompt/ok_btn" ng-disabled="is_unchange()||form.$invalid" class="btn btn-success" ng-click="ok()" type="button">ok</button></div>',j=function(e,t,n,a,i,c,u,p){e.suggest_product=i,e.duplicate_sp=c,e.original_sku=u,e.original_sp=a,initial_blank_sp=new o,initial_blank_sp.is_sale_report=!0,initial_blank_sp.is_taxable=!1,e.sku=u,e.sp=angular.copy(a),null==e.sp&&(null==e.duplicate_sp?e.sp=angular.copy(initial_blank_sp):e.sp=angular.copy(e.duplicate_sp)),!angular.equals(e.sp,initial_blank_sp)&&e.sp.is_kit()&&(e.sp.crv=e.sp.get_crv(),e.sp.cost=e.sp.get_cost(),e.sp.buydown=e.sp.get_buydown()),e._suggest_main_name=null,e._suggest_main_crv=null,e._suggest_main_is_taxable=null,e._suggest_main_price=null,e._suggest_main_cost=null,e._suggest_extra_name=null,e._suggest_extra_crv=null,e._suggest_extra_is_taxable=null,e._suggest_extra_price=null,e._suggest_extra_cost=null,null!==e.suggest_product&&(e._suggest_main_name=e.suggest_product.get_suggest_main("name"),e._suggest_main_crv=e.suggest_product.get_suggest_main("crv"),e._suggest_main_is_taxable=e.suggest_product.get_suggest_main("is_taxable"),e._suggest_main_price=e.suggest_product.get_suggest_main("price"),e._suggest_main_cost=e.suggest_product.get_suggest_main("cost"),e._suggest_extra_name=e.suggest_product.get_suggest_extra("name"),e._suggest_extra_crv=e.suggest_product.get_suggest_extra("crv"),e._suggest_extra_is_taxable=e.suggest_product.get_suggest_extra("is_taxable"),e._suggest_extra_price=e.suggest_product.get_suggest_extra("price"),e._suggest_extra_cost=e.suggest_product.get_suggest_extra("cost")),e.lookup_type_tag=p.filter(function(e){return null!=e.p_type&&null!=e.p_tag}),e.lookup_type=function(){return l.get_type_lst(e.lookup_type_tag)},e.lookup_tag=function(t){return l.get_tag_lst(e.lookup_type_tag,t)},e.update_selected_type_tag=function(){null!=e.selected_type_tag?(e.sp.p_type=e.selected_type_tag.p_type,e.sp.p_tag=e.selected_type_tag.p_tag):(e.sp.p_type=null,e.sp.p_tag=null)},e.get_suggest_main=function(t){return"name"===t?e._suggest_main_name:"crv"===t?e._suggest_main_crv:"is_taxable"===t?e._suggest_main_is_taxable:"price"===t?e._suggest_main_price:"cost"===t?e._suggest_main_cost:void 0},e.get_suggest_extra=function(t){return"name"===t?e._suggest_extra_name:"crv"===t?e._suggest_extra_crv:"is_taxable"===t?e._suggest_extra_is_taxable:"price"===t?e._suggest_extra_price:"cost"===t?e._suggest_extra_cost:void 0},e.is_no_suggestion=function(t){return null===e.get_suggest_main(t)},e.is_many_suggestion=function(t){if(null===e.suggest_product)return!1;var n=e.suggest_product.get_suggest_extra(t);return null!=n&&n.length>1},e.reset=function(){null==e.original_sp?null==e.duplicate_sp?e.sp=angular.copy(initial_blank_sp):e.sp=angular.copy(e.duplicate_sp):e.sp=angular.copy(e.original_sp),e.sku=angular.copy(e.original_sku)},e.is_unchange=function(){var t=angular.equals(e.original_sku,e.sku),n=void 0;return n=null==e.original_sp?null==e.duplicate_sp?angular.equals(e.sp,initial_blank_sp):angular.equals(e.sp,e.duplicate_sp):angular.equals(e.sp,e.original_sp),n&&t},e.can_not_change_sku=function(){return null==e.duplicate_sp},e.is_create_new_sp=function(){return null==e.original_sp},e.calculate_title=function(){return null!=e.suggest_product?"Add: "+e.suggest_product.name:null!=e.duplicate_sp?"Duplicate: "+e.duplicate_sp.name:null==e.original_sp?"Sku not found. Create new product":"Edit: "+e.original_sp.name},e.duplicate_from=function(){r().then(function(t){e.sp.name=t.name,e.sp.price=t.price,e.sp.crv=t.crv,e.sp.is_taxable=t.is_taxable,e.sp.cost=t.cost,e.sp.is_sale_report=t.is_sale_report,e.sp.p_type=t.p_type,e.sp.p_tag=t.p_tag,e.sp.vendor=t.vendor,e.sp.buydown=t.buydown,e.sp.value_customer_price=t.value_customer_price},function(e){s(e)})},e.cancel=function(){t.dismiss("_cancel_")},e.ok=function(){t.close({sku:e.sku,sp:e.sp})}};return j.$inject=["$scope","$modalInstance","$filter","original_sp","suggest_product","duplicate_sp","original_sku","lookup_type_tag"],function(t,r,o,s,a){var i=e.open({template:I,controller:j,backdrop:"static",size:"lg",resolve:{original_sp:function(){return t},suggest_product:function(){return r},duplicate_sp:function(){return o},original_sku:function(){return s},lookup_type_tag:function(){var e=n.defer();return a?e.resolve(l.get_cache()):e.resolve(l.get()),e.promise}}});return i.result}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.type_tag_util",["$rootScope","$q","model.store_product.rest_type_tag",function(e,t,n){var r=void 0,o=function(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];o.p_type===t&&n.push(o.p_tag)}return n},s=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.indexOf(r.p_type)===-1&&t.push(r.p_type)}return t},l=function(){return r},a=function(){return void 0===r?n():t.when(r)};return e.$on("type_tag_downloaded_from_server",function(e,t){r=t}),e.$on("type_tag_uploaded_to_server",function(e,t){if(void 0!==r){var n=s(r);if(n.indexOf(t.p_type)===-1)r.push(t);else{var l=o(r,t.p_type);l.indexOf(t.p_tag)===-1&&r.push(t)}}}),{get_type_lst:s,get_tag_lst:o,get_cache:l,get:a}}]);var mod=angular.module("model.group");mod.requires.push.apply(mod.requires,["share.ui","share.offline_db_util"]),mod.controller("model.group.execute.controller",["$scope","$modalInstance","$http","share.ui.alert","model.group.Group","model.group.rest","share.offline_db_util","group",function(e,t,n,r,o,s,l,a){e.group=a,e.option={},e.checkbox_click=function(t){var n="enable_"+t,r=e[n];r===!1?delete e.option[t]:"is_taxable"===t||"is_sale_report"===t?e.option[t]=!1:"price"===t||(e.option[t]=null)},e.is_option_empty=function(){for(key in e.option)if(e.option.hasOwnProperty(key))return!1;return!0},e.ok=function(){s.execute_item(e.group.id,e.option).then(function(t){l.download_product(!1).then(function(){e.group=o.build(t),r("execute is complete successfully","info","green"),e.option={},e.enable_price=!1,e.enable_crv=!1,e.enable_is_taxable=!1,e.enable_cost=!1,e.enable_is_sale_report=!1,e.enable_p_tag=!1,e.enable_p_tag=!1,e.enable_vendor=!1,e.enable_buydown=!1,e.enable_value_customer_price=!1},function(e){r(e)})},function(e){r(e)})},e.exit=function(){t.dismiss("_cancel_")}}]);var mod=angular.module("model.group");mod.factory("model.group.execute",["$modal","$templateCache","model.group.rest",function(e,t,n){return function(r){var o=e.open({template:t.get("model.group.execute.main.html"),controller:"model.group.execute.controller",size:"lg",resolve:{group:function(){return n.get_item(r)}}});return o}}]);var mod=angular.module("model.product");mod.controller("model.product.network_product.controller",["$scope","share_setting",function(e,t){function n(e){var t=!1;return 0!==e.get_sp_lst().length&&(t=void 0!==e.get_sp_lst()[0].sale),t}e.share_setting=t,e.init=function(t){e.network_product=t,e.network_product_summary_lbl_class="col-xs-4 control-label",e.network_product_summary_value_class="col-xs-8 form-control-static",e.suggest_extra_crv=e.network_product.get_suggest_extra("crv"),e.suggest_extra_name=e.network_product.get_suggest_extra("name"),e.is_sale_data=n(t),e.cur_sort_column="get_cost()",e.cur_sort_desc=!1,e.column_click=function(t){e.cur_sort_column==t?e.cur_sort_desc=!e.cur_sort_desc:(e.cur_sort_column=t,e.cur_sort_desc=!1)},e.get_sort_class=function(t){return t==e.cur_sort_column?"glyphicon glyphicon-arrow-"+(e.cur_sort_desc?"down":"up"):""}},e.$on("network_product_is_updated",function(t,n){e.init(n)})}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.rest_crud",["$http","$rootScope","$q","model.store_product.Store_product",function(e,t,n,r){var o=function(e,n){var o=r.build(e),s={p_type:o.p_type,p_tag:o.p_tag};t.$emit("type_tag_uploaded_to_server",s),n.resolve(o)},s=function(t,r){var s=n.defer();return e({url:"/sp/insert_new_sp_angular",method:"POST",data:{sku_str:r,sp:JSON.stringify(t)}}).then(function(e){o(e.data,s)},function(e){null!==e.data&&void 0!==e.data&&e.data.indexOf("duplicate key value violates unique constraint")!==-1&&e.data.indexOf("Key (name, store_id)=")!==-1?s.reject(t.name+" is existed. Please select another name"):s.reject(e)}),s.promise},l=function(t,r,s){var l=n.defer();return e({url:"/sp/sp_insert_old_angular",method:"POST",data:{product_id:t,sku_str:r,sp:JSON.stringify(s)}}).then(function(e){o(e.data,l)},function(e){null!==e.data&&void 0!==e.data&&e.data.indexOf("duplicate key value violates unique constraint")!==-1&&e.data.indexOf("Key (name, store_id)=")!==-1?l.reject(s.name+" is existed. Please select another name"):l.reject(e)}),l.promise},a=function(t){var r=n.defer();return e({url:"/sp/update_sp_angular",method:"POST",data:{sp:JSON.stringify(t)}}).then(function(e){o(e.data,r)},function(e){r.reject(e)}),r.promise};return{insert_new:s,insert_old:l,update:a}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["model.product"]),mod.factory("model.store_product.rest_search",["$q","$http","model.store_product.Store_product","model.product.Product",function(e,t,n,r){function o(r){var o=e.defer();return t({url:"/sp/search_by_product_id",method:"GET",params:{product_id:r}}).then(function(e){var t=n.build(e.data);o.resolve(t)},function(e){o.reject(e)}),o.promise}function s(r,o){var s=e.defer();if(r=r.trim(),0==r.length)return s.reject("error: name search is empty"),s.promise;var l=r.split(" ");return l.length>2?(s.reject("error: search 2 words maximum"),s.promise):(t({url:"/sp/search_by_name_angular",method:"GET",params:{name_str:r,after:o}}).then(function(e){s.resolve(e.data.map(n.build))},function(e){s.reject(e)}),s.promise)}function l(o){if(o=o.trim(),0==o.length)return e.reject("error: sku is empty");if(o.indexOf(" ")>=0)return e.reject("error: sku cannot contain space");var s=e.defer();return t({url:"/sp/search_by_sku_angular",method:"GET",params:{sku_str:o}}).then(function(e){var t={prod_store__prod_sku__1_1:e.data.prod_store__prod_sku__1_1.map(n.build),prod_store__prod_sku__1_0:e.data.prod_store__prod_sku__1_0.map(n.build),prod_store__prod_sku__0_0:e.data.prod_store__prod_sku__0_0.map(r.build)};s.resolve(t)},function(e){s.reject(e)}),s.promise}function a(r,o){var s=r.split(" ");if(s.length>2)return e.reject("2 words search max");var l=e.defer();return t({url:"/sp/search_by_name_sku_angular",method:"GET",params:{search_str:r,after:o}}).then(function(e){l.resolve(e.data.map(n.build))},function(e){l.reject(e)}),l.promise}return{by_id:o,by_name:s,by_sku:l,by_name_sku:a}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.rest_sku",["$http","$q","model.store_product.Store_product",function(e,t,n){return{add_sku:function(r,o){var s=t.defer();return e({url:"/sp/sku_add_angular",method:"POST",data:{product_id:r,sku_str:o}}).then(function(e){s.resolve(n.build(e.data))},function(e){s.reject(e)}),s.promise},delete_sku:function(r,o){var s=t.defer();return e({url:"/sp/sku_assoc_delete_angular",method:"POST",data:{product_id:r,sku_str:o}}).then(function(e){s.resolve(n.build(e.data))},function(e){s.reject(e)}),s.promise}}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.rest_type_tag",["$rootScope","$http","$q",function(e,t,n){return function(){var r=n.defer();return t({url:"/sp/get_lookup_type_tag",method:"GET"}).then(function(t){e.$emit("type_tag_downloaded_from_server",t.data),r.resolve(t.data)},function(e){r.reject(e)}),r.promise}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.ui","model.product"]),mod.factory("model.store_product.sku_not_found_handler",["$http","$q","model.store_product.sku_not_found_handler.create.new","model.store_product.sku_not_found_handler.create.old","model.store_product.rest_sku","model.store_product.sku_not_found_handler.select_suggestion","share.ui.alert","model.store_product.Store_product","model.product.Product",function(e,t,n,r,o,s,l,a,i){return function(e,c,u){var p=t.defer();return s(e,c,u).then(function(e){if(null===e)n(u).then(function(e){p.resolve(e)},function(e){p.reject(e)});else if(e instanceof a){var t=e;o.add_sku(t.product_id,u).then(function(e){p.resolve(e)},function(e){p.reject(e)})}else if(e instanceof i){var s=e;r(s,u).then(function(e){p.resolve(e)},function(e){p.reject(e)})}else l("Bug: Unexpected select option:"+e.constructor.name)},function(e){p.reject(e)}),p.promise}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.ui"]),mod.factory("model.store_product.search.online.infinite_scroll_handler",["$q","model.store_product.rest_search",function(e,t){return function(n,r,o,s){if(n.infinite_scroll_reach_the_end)return e.when();if(void 0===n.infinite_scroll_busy)n.infinite_scroll_busy=!1;else if(n.infinite_scroll_busy===!0)return e.when();var l=e.defer(),a=s.length;n.infinite_scroll_busy=!0;var i;return i=o?t.by_name:t.by_name_sku,i(r,a).then(function(e){s.push.apply(s,e),n.infinite_scroll_reach_the_end=0===e.length,n.infinite_scroll_busy=!1,l.resolve()},function(e){l.reject(e)}),l.promise}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.create.new",["$http","$q","model.store_product.prompt","model.store_product.rest_crud",function(e,t,n,r){return function(e){var o=t.defer();return n(null,null,null,e,!1).then(function(t){r.insert_new(t.sp,e).then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.create.old",["$http","$q","model.store_product.prompt","model.store_product.rest_crud",function(e,t,n,r){return function(e,o){var s=t.defer();return n(null,e,null,o,!1).then(function(t){r.insert_old(e.product_id,o,t.sp).then(function(e){s.resolve(e)},function(e){s.reject(e)})},function(e){s.reject(e)}),s.promise}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.select_suggestion",["$modal","$q","model.store_product.sku_not_found_handler.select_suggestion.store_product","model.store_product.sku_not_found_handler.select_suggestion.product",function(e,t,n,r){
return function(e,o,s){var l=t.defer();return 0===e.length&&0===o.length?l.resolve(null):0!==o.length?n(e,o,s).then(function(e){l.resolve(e)},function(e){l.reject(e)}):r(e,o,s).then(function(e){l.resolve(e)},function(e){l.reject(e)}),l.promise}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.util"]),mod.controller("model.store_product.search.online.multiple.controller",["$scope","$modalInstance","model.store_product.rest_search","share.util.misc","model.store_product.search.online.infinite_scroll_handler",function(e,t,n,r,o){e.message="",e.sp_lst="",e.result_sp_lst=[],e.infinite_scroll_reach_the_end=!1,e.is_blur_infinite_scroll_triggerer_textbox=!1,e.search_str="",e.ok=function(){t.close(e.result_sp_lst)},e.is_sp_selected=function(t){return null!=r.get_item_from_lst_base_on_id(t.id,e.result_sp_lst)},e.reset=function(){e.result_sp_lst=[]},e.toggle_select=function(t){e.is_sp_selected(t)?e.remove(t):e.result_sp_lst.push(t)},e.remove=function(t){for(var n=null,r=0;r<e.result_sp_lst.length;r++)if(t.id==e.result_sp_lst[r].id){n=r;break}e.result_sp_lst.splice(n,1)},e.search=function(){if(e.search_str=e.search_str.trim(),0==e.search_str.length)return e.sp_lst=[],void(e.message="");var t=0;e.infinite_scroll_reach_the_end=!1,n.by_name_sku(e.search_str,t).then(function(t){e.sp_lst=t,0==e.sp_lst.length?e.message="no result for '"+e.search_str+"'":(e.message="",e.is_blur_infinite_scroll_triggerer_textbox=!0)},function(t){e.message=t})},e.cancel=function(){t.dismiss("_cancel_")},e.infinite_scroll_handler=function(){""!==e.search_str&&o(e,e.search_str,!1,e.sp_lst)}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.search.online.multiple",["$modal","$templateCache",function(e,t){return function(){var n=e.open({template:t.get("model.store_product.search.online.multiple.template.html"),controller:"model.store_product.search.online.multiple.controller",size:"lg"});return n.result}}]);var mod=angular.module("model.store_product");mod.requires.push.apply(mod.requires,["share.ui"]),mod.controller("model.store_product.search.online.single.controller",["$scope","$modalInstance","$http","model.store_product.rest_search","share.ui.alert","model.store_product.search.online.infinite_scroll_handler",function(e,t,n,r,o,s){e.message="",e.sp_lst="",e.infinite_scroll_reach_the_end=!1,e.search_str="",e.is_blur_infinite_scroll_triggerer_textbox=!1,e.select=function(e){t.close(e)},e.cancel=function(){t.dismiss("_cancel_")},e.search=function(t){if(e.search_str=e.search_str.trim(),0===e.search_str.length)return e.sp_lst=[],void(e.message="");var n=0;e.infinite_scroll_reach_the_end=!1,r.by_name_sku(e.search_str,n).then(function(t){e.sp_lst=t,0==e.sp_lst.length?e.message="no result for '"+e.search_str+"'":(e.message="",e.is_blur_infinite_scroll_triggerer_textbox=!0)},function(t){e.message=t})},e.infinite_scroll_handler=function(){""!==e.search_str&&s(e,e.search_str,!1,e.sp_lst)}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.search.online.single",["$modal","$templateCache",function(e,t){return function(){var n=e.open({template:t.get("model.store_product.search.online.single.template.html"),controller:"model.store_product.search.online.single.controller",size:"lg"});return n.result}}]);var mod=angular.module("model.store_product");mod.controller("model.store_product.sku_not_found_handler.select_suggestion.product.controller",["$scope","$modalInstance","$injector","model.store_product.sku_not_found_handler.select_suggestion.product.confirm","product_lst","my_sp_lst","sku",function(e,t,n,r,o,s,l){e.product_lst=o,e.my_sp_lst=s,e.sku=l,e.cancel=function(){t.dismiss("_cancel_")},e.select_product=function(e){r(e,o,s,l).then(function(e){t.close(e)},function(e){t.dismiss(e)})},e.select_sp=function(){var e=n.get("model.store_product.sku_not_found_handler.select_suggestion.store_product");e(o,s,l).then(function(e){t.close(e)},function(e){t.dismiss(e)})},e.create_new_product=function(){t.close(null)}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.select_suggestion.product",["$modal","$templateCache",function(e,t){return function(n,r,o){var s=e.open({template:t.get("model.store_product.sku_not_found_handler.select_suggestion.product.template.html"),controller:"model.store_product.sku_not_found_handler.select_suggestion.product.controller",size:"lg",backdrop:"static",resolve:{product_lst:function(){return n},my_sp_lst:function(){return r},sku:function(){return o}}});return s.result}}]);var mod=angular.module("model.store_product");mod.controller("model.store_product.sku_not_found_handler.select_suggestion.store_product.controller",["$scope","$modalInstance","$injector","share.ui.confirm","product_lst","my_sp_lst","sku",function(e,t,n,r,o,s,l){e.product_lst=o,e.my_sp_lst=s,e.sku=l,e.cancel=function(){t.dismiss("_cancel_")},e.return_sp=function(e){r("Confirm: adding "+l+" sku to "+e.name+" ?").then(function(){t.close(e)})},e.select_product=function(){var e=n.get("model.store_product.sku_not_found_handler.select_suggestion.product");e(o,s,l).then(function(e){t.close(e)},function(e){t.dismiss(e)})},e.create_new_product=function(){t.close(null)}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.select_suggestion.store_product",["$modal","$templateCache",function(e,t){return function(n,r,o){var s=e.open({template:t.get("model.store_product.sku_not_found_handler.select_suggestion.store_product.template.html"),controller:"model.store_product.sku_not_found_handler.select_suggestion.store_product.controller",size:"lg",backdrop:"static",resolve:{product_lst:function(){return n},my_sp_lst:function(){return r},sku:function(){return o}}});return s.result}}]);var mod=angular.module("model.store_product");mod.controller("model.store_product.sku_not_found_handler.select_suggestion.product.confirm.controller",["$scope","$modalInstance","$injector","share_setting","network_product","product_lst","my_sp_lst","sku",function(e,t,n,r,o,s,l,a){e.network_product=o,e.share_setting=r,e.cancel=function(){t.dismiss("_cancel_")},e.return_product=function(){t.close(o)},e.select_product=function(){var e=n.get("model.store_product.sku_not_found_handler.select_suggestion.product");e(s,l,a).then(function(e){t.close(e)},function(e){t.dismiss(e)})}}]);var mod=angular.module("model.store_product");mod.factory("model.store_product.sku_not_found_handler.select_suggestion.product.confirm",["$modal","$templateCache",function(e,t){return function(n,r,o,s){var l=e.open({template:t.get("model.store_product.sku_not_found_handler.select_suggestion.product.confirm.template.html"),controller:"model.store_product.sku_not_found_handler.select_suggestion.product.confirm.controller",size:"lg",backdrop:"static",resolve:{network_product:function(){return n},product_lst:function(){return r},my_sp_lst:function(){return o},sku:function(){return s}}});return l.result}}]);var mod=angular.module("app.construct_app_setting",["model.mix_match","model.store"]);mod.factory("app.construct_app_setting",["model.mix_match.Mix_match","model.store.Store",function(e,t){return function(n){"string"==typeof n.STORE&&(n.STORE=JSON.parse(n.STORE)),"string"==typeof n.MIX_MATCH_LST&&(n.MIX_MATCH_LST=JSON.parse(n.MIX_MATCH_LST)),"string"==typeof n.PAYMENT_TYPE_LST&&(n.PAYMENT_TYPE_LST=JSON.parse(n.PAYMENT_TYPE_LST)),"string"==typeof n.SHORTCUT_LST&&(n.SHORTCUT_LST=JSON.parse(n.SHORTCUT_LST));var r={STORE:t.build(n.STORE),STORE_ID:n.STORE_ID,TAX_RATE:n.TAX_RATE,COUCH_SERVER_URL:n.COUCH_SERVER_URL,STORE_DB_PREFIX:n.STORE_DB_PREFIX,MIX_MATCH_LST:n.MIX_MATCH_LST.map(e.build),PAYMENT_TYPE_LST:n.PAYMENT_TYPE_LST,SHORTCUT_LST:n.SHORTCUT_LST,SHORTCUT_ROW_COUNT:n.SHORTCUT_ROW_COUNT,SHORTCUT_COLUMN_COUNT:n.SHORTCUT_COLUMN_COUNT,STORE_PRODUCT_DOCUMENT_TYPE:n.STORE_PRODUCT_DOCUMENT_TYPE,RECEIPT_DOCUMENT_TYPE:n.RECEIPT_DOCUMENT_TYPE,STATIC_URL:n.STATIC_URL,MAX_RECEIPT_SNOOZE_1:30,MAX_RECEIPT_SNOOZE_2:60,MAX_RECEIPT:200,VIEW_BY_PRODUCT_ID:n.VIEW_BY_PRODUCT_ID,VIEW_BY_SKU:n.VIEW_BY_SKU,VIEW_BY_D_TYPE:n.VIEW_BY_D_TYPE};return r}}]);var mod=angular.module("app.productApp");mod.requires.push.apply(mod.requires,["ui.bootstrap","infinite-scroll","blockUI","share.util.csrf","share.filter","share.directive","share.menu","app.productApp.partial"]),mod.config(["$sceDelegateProvider",function(e){e.resourceUrlWhitelist(["self"])}]),mod.config(["blockUIConfig",function(e){e.message="loading ...",e.autoBlock=!0,e.delay=0}]);var app=angular.module("app.productApp");app.requires.push.apply(app.requires,["model.store_product","share.ui","share.offline_db_util"]),app.controller("app.productApp.controller",["$scope","$rootScope","$q","$window","model.store_product.rest_search","share.ui.alert","share.ui.confirm","model.store_product.sku_not_found_handler","share.offline_db_util","model.store_product.search.online.infinite_scroll_handler",function(e,t,n,r,o,s,l,a,i,c){function u(){r.open("sale/index_angular/")}function p(){e.sp_lst=[],e.name_search_str="",e.sku_search_str=""}var d=t.$on("model.group.manage",function(e,t){p()});e.$on("$destroy",d),e.launch_pos=function(){i.is_exist().then(function(e){e?l("launch sale app?").then(function(){u()}):l("first time download database. continue?").then(function(){u()})},function(e){s(e)})},e.sku_search=function(){return e.name_search_str="",e.local_filter="",e.sku_search_str=e.sku_search_str.trim().toLowerCase(),0===e.sku_search_str.length?void(e.sp_lst=[]):void o.by_sku(e.sku_search_str).then(function(t){if(e.sp_lst=t.prod_store__prod_sku__1_1,0===e.sp_lst.length){a(t.prod_store__prod_sku__0_0,t.prod_store__prod_sku__1_0,e.sku_search_str).then(function(t){e.sp_lst=[t]},function(e){s(e)})}},function(e){s(e)})},e.column_click=function(t){e.cur_sort_column===t?e.cur_sort_desc=!e.cur_sort_desc:(e.cur_sort_column=t,e.cur_sort_desc=!1)},e.get_sort_class=function(t){return t===e.cur_sort_column?"glyphicon glyphicon-arrow-"+(e.cur_sort_desc?"down":"up"):""},e.name_search=function(){e.sku_search_str="",e.local_filter="",e.infinite_scroll_reach_the_end=!1,e.name_search_str=e.name_search_str.trim(),e.sp_lst=[],0!==e.name_search_str.length&&o.by_name(e.name_search_str,0).then(function(t){e.sp_lst=t,0===t.length?s('no result found for "'+e.name_search_str+'"',"info","blue"):e.is_blur_infinite_scroll_triggerer_textbox=!0},function(e){s(e)})},e.infinite_scroll_handler=function(){0!==e.name_search_str.length&&c(e,e.name_search_str,!0,e.sp_lst)},e.cur_sort_column="name",e.cur_sort_desc=!1,e.infinite_scroll_reach_the_end=!1,e.is_blur_infinite_scroll_triggerer_textbox=!1,e.sp_lst=[],e.name_search_str="",e.sku_search_str=""}]);var mod=angular.module("app.productApp");mod.requires.push.apply(mod.requires,["app.construct_app_setting"]),mod.value("share_setting",_GLOBAL_SETTING_),mod.run(["app.construct_app_setting","share_setting",function(e,t){var n=e(t);for(var r in n)t[r]=n[r]}]);